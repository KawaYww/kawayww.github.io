<!doctype html><html lang=zh-Hans><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>柳上川</title><meta content=柳上川的博客 name=description><link href=/styles/tailwind.css rel=stylesheet><body><link rel="shortcut icon" href=/images/blog/avatar.avif type=image/x-icon><link href=/styles/highlight.min.css rel=stylesheet><link href=/fonts/MapleMono-NF-CN-Regular/result.css rel=stylesheet><link href=/fonts/MapleMono-NF-CN-Italic/result.css rel=stylesheet><link href=/fonts/MapleMono-NF-CN-Bold/result.css rel=stylesheet><script src=/scripts/highlight.min.js></script><script src=/scripts/rust.min.js></script><script src=/scripts/nix.min.js></script><script src=/scripts/scheme.min.js></script><script>hljs.highlightAll();
    document.addEventListener('DOMContentLoaded', function(event) {
      hljs.highlightAll();
    });
    window.addEventListener('pageshow', function(event) {
      // 如果页面是从 bfcache (Back-Forward Cache) 中恢复的
      if (event.persisted) {
        hljs.highlightAll();
      }
    });
    document.addEventListener('htmx:afterSwap', function(event) {
      hljs.highlightAll();
    });</script><script defer src=/scripts/prefetch.js></script><script>if (!document.querySelector('meta[name="darkreader-lock"]')) {
      const lock = document.createElement('meta');
      lock.name = 'darkreader-lock';
      document.head.appendChild(lock);
    }</script><link href=/styles/catppuccin-macchiato.css rel=stylesheet><script src=/scripts/htmx.min.js></script><link href=/styles/tailwind.css rel=stylesheet><link href=/iconfonts/iconfont.css rel=stylesheet><div class="flex flex-col mx-4 mb-20 scroll-smooth" id=content lang=zh-Hans><div class="text-2xl sm:text-3xl my-4 w-full text-center">『rust-typed-magic: 泛型关联类型(GATs)』</div><div class="font-medium w-fit sm:mx-auto flex flex-col border-l-4 pl-2 sm:flex-row sm:border-l-0 sm:pl-0"><p>写自:2024-04-24<div class="px-2 hidden sm:inline">│</div><p>作者:柳上川<div class="px-2 hidden sm:inline">│</div><p>系列:<a class="underline underline-offset-5" hx-swap="innerHTML show:window:top" href=/categories/rust-typed-magic hx-get=/categories/rust-typed-magic/index.html hx-push-url=/categories/rust-typed-magic hx-target=body>rust-typed-magic</a></div><div class="flex flex-col items-center m-4"><div class="w-fit mx-auto text-lg font-semibold">摘要</div><div class="w-fit break-keep text-center sm:mx-[25%] *:inline">学习 rust 中的 gat(泛型关联类型), HKT(高阶类型), type-constructor(类型构造器) 等概念</div></div><div class="flex flex-col my-10 w-fit border-2 border-slate-500"><p><span class=text-2xl>目录:</span><div class="w-fit pr-2 my-2"><div class=leading-5><span class=pl-2><span class="font-bold text-sm">┌─►</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#guan-lian-lei-xing>关联类型</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#ding-yi>定义</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#shu-ru-yu-shu-chu>输入与输出</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#gong-cheng-xue-you-dian>工程学优点</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├─►</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#fan-xing-guan-lian-lei-xing>泛型关联类型</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├─►</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#type-amp-amp-kind>Type && Kind</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├─►</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#lei-xing-gou-zao-qi>类型构造器</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├─►</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#gao-jie-lei-xing-hkt>高阶类型(HKT)</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├─►</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#li-zi>例子</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#rong-qi-lei-xing>容器类型</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#functor>Functor</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#selffan-xing>Self泛型</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">├───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#family-trait>family-trait</a></span></div><div class=leading-5><span class=pl-2><span class="font-bold text-sm">└───</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href=#jie-dai-die-dai>借贷迭代</a></span></div></div></div><hr class="border-2 border-dashed my-10"><h1 class="flex items-center w-fit my-6" id=guan-lian-lei-xing><span class="text-2xl mr-2 text-cyan-500">🔗</span> <a class="text-4xl hover:underline underline-offset-8" href=#guan-lian-lei-xing>关联类型</a></h1><p><em>关联类型(associated-type)</em> 非常常见<br><h2 class="flex items-center w-fit my-6" id=ding-yi><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#ding-yi>定义</a></h2><p>让我们以标准库中的 <a class="underline underline-offset-5 font-medium" href=https://doc.rust-lang.org/std/ops/trait.Add.html>Add</a> 为例开始:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Add&lt;Rhs = Self> {
    type Output;

    fn add(self, rhs: Rhs) -> Self::Output;
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>该定义中的 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code> 便是所谓的 <em>关联类型(associated-type)</em>, 而 <code class="font-semibold text-[#aa8bd5]"><code>Rhs</code></code> 则是普通的泛型, 默认值是 <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code><br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">impl Add for i32 {
    type Output = i32;

    fn add(self, other: i32) -> Self::Output { self + other }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>我们在实现中指定 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code> 的类型, 而 <code class="font-semibold text-[#aa8bd5]"><code>Rhs</code></code> 也已经推导为 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code><br>关联类型的出现是必要的, 在这里, 我们需要先澄清一下 trait 的 <em>输入类型(input)</em> 与 <em>输出类型(output)</em><br><h2 class="flex items-center w-fit my-6" id=shu-ru-yu-shu-chu><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#shu-ru-yu-shu-chu>输入与输出</a></h2><ul class="list-disc ml-5"><li><code class="font-semibold text-[#aa8bd5]"><code>input</code></code>: <code class="font-semibold text-[#aa8bd5]"><code>Add</code></code> 中的泛型参数 <code class="font-semibold text-[#aa8bd5]"><code>Rhs</code></code><li><code class="font-semibold text-[#aa8bd5]"><code>output</code></code>: <code class="font-semibold text-[#aa8bd5]"><code>Add</code></code> 中的关联类型 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code></ul><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">impl Add&lt;i32> for i32 { ... }
impl Add&lt;Complex> for i32 { ... }</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>考虑这两种 <code class="font-semibold text-[#aa8bd5]"><code>impl</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Add&lt;i32></code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>Add&lt;Complex></code></code> 被视作两个不一样的 trait<br>作为类型参数的 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>Complex</code></code> 都是该 trait 的输入, 通过输入, 才最终确定并形成了这两个不同的 trait<br>但对于关联类型, 它是某个已经确定了的 trait 的输出, 因此它只可能在 impl 的时候由实现者确定, 不参与 trait 的类型推断<br><br>倘若没有关联类型, 我们只能全部写进泛型中当作参数<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">impl Add&lt;i32, i32> for i32 { ... }
impl Add&lt;Complex, Complex> for i32 { ... }</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>以第一个 impl 为例子, 第一个 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code> 代表 <code class="font-semibold text-[#aa8bd5]"><code>Rhs</code></code>, 第二个 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code> 代表 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code>, 但现在你还分得清 input 与 output 吗?<br>不仅如此, 原本不该参与 通过泛型列表确认是哪个trait 这一推导过程, 而应由实现者在 impl 内部指定的 Output, 此刻却暴露了出来<br><h2 class="flex items-center w-fit my-6" id=gong-cheng-xue-you-dian><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#gong-cheng-xue-you-dian>工程学优点</a></h2><p>你可能还是有点懵, 那就再以 <a class="underline underline-offset-5 font-medium" href=https://rust-lang.github.io/rfcs/0195-associated-items.html#associated-types-engineering-benefits-for-generics>rfc-0195</a> 中的代码为例子 (有些地方和真代码不一样, 看得懂即可):<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Graph&lt;N, E> {
    fn has_edge(&self, &N, &N) -> bool;
    ...
}

fn distance&lt;N, E, G: Graph&lt;N, E>>(graph: &G, start: &N, end: &N) -> uint { ... }</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>我们有一个 <code class="font-semibold text-[#aa8bd5]"><code>Graph</code></code> trait, 来表示图论算法中的图, 涉及 3 种类型: <em>节点(Node)</em>, <em>边(Edge)</em>, <em>图(Graph)</em><br>如果我们定义了这样的 trait 并为某个具体的类型实现, 按理来说 <em>节点(N)</em> 与 <em>边(E)</em> 也是与该具体类型相关联的具体类型<br>但暴露给用户的却是必须强制写出来后才能使用的泛型参数, 这一点相当令人困惑<br><br>但倘若用关联类型改写:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Graph {
    type N;
    type E;
    fn has_edge(&self, &N, &N) -> bool;
}

fn distance&lt;G: Graph>(graph: &G, start: &G::N, end: &G::N) -> uint { ... }</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>下游的用户在使用时不再需要被强迫写成泛型, 需要引用 <code class="font-semibold text-[#aa8bd5]"><code>Node</code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>Edge</code></code> 代表的具体类型时, 直接通过 <code class="font-semibold text-[#aa8bd5]"><code>G::N</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>G::E</code></code> 来使用即可<br><br>这在工程学上有着相当大的优势, 而且是单纯的泛型绝对替代不了的 (我直接翻译 rfc-0195 中的原文了):<br><ul class="list-disc ml-5"><li>可读性/可扩展性:<br></ul><p>关联类型可以一次抽象出整个类型系列，而不必单独命名每个类型, 这提高了泛型代码的可读性 (如上面的 <code class="font-semibold text-[#aa8bd5]"><code>distance</code></code> 函数)<br>它还使泛型更具 “可扩展性”: trait 可以包含其他关联类型, 而不会给 "不关心这些类型的客户端" 带来额外的负担<br>相比之下, 在今天的 rust 中，为一个 trait 添加额外的泛型参数, 通常感觉是个非常 “重量级” 的举动<br><br><ul class="list-disc ml-5"><li>易于重构/演进:<br></ul><p>由于 trait 的用户不必单独对其关联类型进行泛型参数化, 因此可在不破坏现有客户端代码的情况下, 添加新的关联类型<br>(泛型的话, 你每次添加新的代码, 用户也得给每个函数都加上新的泛型参数啦!! 想想刚刚的 <code class="font-semibold text-[#aa8bd5]"><code>distance</code></code>, 这会破坏所有涉及该 trait 的代码)<br><hr class="border-2 border-dashed my-10"><h1 class="flex items-center w-fit my-6" id=fan-xing-guan-lian-lei-xing><span class="text-2xl mr-2 text-cyan-500">🔗</span> <a class="text-4xl hover:underline underline-offset-8" href=#fan-xing-guan-lian-lei-xing>泛型关联类型</a></h1><p>关联类型允许泛型, 就是所谓的泛型关联类型啦! (废话!)<br>(但是这玩意儿让 rust 团队写了七年, 期间重构数次编译器与类型分析系统)<br><br>现在要介绍的, 是 rust 自 1.65 版本后引入的重大特性, 泛型关联类型(GAT/GATs, Generic-Associated-Types)<br>这是个相当重量级的特性, rust 团队为了支持这个特性, 写了整整将近 7 年, 诞生了诸如 <a class="underline underline-offset-5 font-medium" href=https://github.com/rust-lang/chalk>chalk</a> 等项目<br><br>(没错, 将近 7 年, 确切来说是 6.5 年, 而且至今仍在完善)<br><br>但现在(1.79)版本下, gat 仍然有相当多的不完善之处, 对其支持仅仅是最小化支持, 且带有相当多限制<br>但即使如此, 也已经相当够用了<br><br>顾名思义, 泛型关联类型, 也就是在关联类型的基础上添加了泛型, 仍然是关联类型的一种:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Container {
    type Value&lt;T>;  // Here
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>是的, 你没有看错, 仅仅是使得关联类型的位置能够支持泛型了<br>但这却解决了非常非常多的问题, 让 rust 能模拟一个非常重要的语法特性: <em>HKT(高阶类型, Higher-Kinded-Type)</em><br><br><em>GATs</em> 让我们拥有了使用 <em>type-constructor(类型构造器)</em> 的能力<br><hr class="border-2 border-dashed my-10"><h1 class="flex items-center w-fit my-6" id=type-amp-amp-kind><span class="text-2xl mr-2 text-cyan-500">🔗</span> <a class="text-4xl hover:underline underline-offset-8" href=#type-amp-amp-kind>Type && Kind</a></h1><p>那么什么是 <em>type-constructor</em> 呢? 介绍它之前, 先让我们了解一下 <em>type(类型)</em> 与 <em>kind(阶)</em> 的概念<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">fn not(x: bool) -> bool {
    !x
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><ul class="list-disc ml-5"><li><code class="font-semibold text-[#aa8bd5]"><code>not</code></code> 函数接收一个 type 为 bool 的参数, 返回一个 type 为 <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code> 的值, 因此 <code class="font-semibold text-[#aa8bd5]"><code>not</code></code> 的 type 就是 <code class="font-semibold text-[#aa8bd5]"><code>bool -> bool</code></code><li><code class="font-semibold text-[#aa8bd5]"><code>x</code></code> 这个参数的 type 则是 <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code></ul><p>type 表示 <em>值的类型</em>, 那么什么是 <em>kind</em> 呢? 其实这也是较好理解的, 是基于 type 再往上抽象了一层的产物:<br><div class="my-4 mx-2 sm:mx-6"><svg style="overflow: visible;" viewbox="0 0 204 86.28" class=typst-doc height=86.28pt width=204pt xmlns=http://www.w3.org/2000/svg xmlns:h5=http://www.w3.org/1999/xhtml xmlns:xlink=http://www.w3.org/1999/xlink><g><g transform="translate(0 -0.5)"><path d="M 0 0 L 0 87.28" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(48.800000000000004 -0.5)"><path d="M 0 0 L 0 87.28" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(155.2 -0.5)"><path d="M 0 0 L 0 87.28" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(204 -0.5)"><path d="M 0 0 L 0 87.28" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 0)"><path d="M 0 0 L 205 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 28.76)"><path d="M 0 0 L 205 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 57.52)"><path d="M 0 0 L 205 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 86.28)"><path d="M 0 0 L 205 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(10 18.76)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gB0AD4B9E45FCD3A39DF21B876F9D786A /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gFAD478CE862F2D6C34794B876E1926AC /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g7AE160FE6B218E6AB522E63980D40CF0 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#gB427A7439F058EB92F82F16C414E556A /></g></g><g transform="translate(58.800000000000004 18.76)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gC702EA3AED0A9145E9F876A87F52EF81 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#g98493CFC19E36EB6ADBD2B9416F48CBF /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gCF7D89FBA207214DF810E4E36ECCA400 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#gB427A7439F058EB92F82F16C414E556A /></g></g><g transform="translate(165.2 18.76)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g74125599FC16DAB87B122488958C9A8 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#g1D3C0C2100A43DB91C82131EC9CB01AB /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gB0AD4B9E45FCD3A39DF21B876F9D786A /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g58A034053C0707D955174AFF6BC38BDD /></g></g><g transform="translate(10 47.52)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g84625F86F5A91CCBD98FD3E1C20FDBD2 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /></g></g><g transform="translate(58.800000000000004 47.52)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gB67AB626BA72DA69B1B65382C206CCFD /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g9B0C0AD8F1AEB228C1E075A06DAB0CCF /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#gF230359563E3A81C6A494BE4E8C24E0E /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g3A2E5E0A954DE8439AAF463B454E3773 /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#gB67AB626BA72DA69B1B65382C206CCFD /><use fill=#ffffff fill-rule=nonzero x=64.80000000000001 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=72.00000000000001 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=79.20000000000002 xlink:href=#g9B0C0AD8F1AEB228C1E075A06DAB0CCF /></g></g><g transform="translate(165.2 47.52)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 76.28)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gBCD61CC537844E9A88540E6CBD172274 /></g></g><g transform="translate(58.800000000000004 76.28)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gB67AB626BA72DA69B1B65382C206CCFD /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g9B0C0AD8F1AEB228C1E075A06DAB0CCF /></g></g><g transform="translate(165.2 76.28)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g></g><defs id=glyph><symbol id=gB0AD4B9E45FCD3A39DF21B876F9D786A overflow=visible><path d="M 2.448 0.672 L 2.448 3.78 C 2.448 4.512 2.964 5.232 3.732 5.232 C 4.464 5.232 4.752 4.584 4.752 3.9720001 L 4.752 0.672 C 4.752 0.144 5.0160003 -0.120000005 5.544 -0.120000005 C 6.084 -0.120000005 6.336 0.144 6.336 0.672 L 6.336 4.308 C 6.336 5.688 5.484 6.7200003 4.008 6.7200003 C 3.204 6.7200003 2.652 6.2400002 2.4 5.4240003 L 2.4 5.94 C 2.4 6.468 2.088 6.7200003 1.608 6.7200003 C 1.116 6.7200003 0.864 6.468 0.864 5.94 L 0.864 0.672 C 0.864 0.144 1.116 -0.120000005 1.656 -0.120000005 C 2.184 -0.120000005 2.448 0.144 2.448 0.672 Z"/></symbol><symbol id=gFAD478CE862F2D6C34794B876E1926AC overflow=visible><path d="M 2.808 -0.120000005 C 3.636 -0.120000005 4.224 0.276 4.596 0.948 C 4.644 1.0320001 4.692 1.104 4.728 1.188 C 4.764 0.984 4.8 0.78000003 4.848 0.576 C 4.9440002 0.096 5.304 -0.120000005 5.796 -0.120000005 C 6.288 -0.120000005 6.42 0.096 6.3120003 0.576 C 6.084 1.62 6 2.532 6 3.408 C 5.988 4.272 6.072 5.136 6.204 6.012 C 6.264 6.492 6.084 6.7200003 5.592 6.7200003 C 5.112 6.7200003 4.8120003 6.492 4.728 6.012 C 4.728 5.976 4.728 5.952 4.716 5.916 C 4.44 6.384 4.02 6.7200003 3.348 6.7200003 C 2.436 6.7200003 1.752 6.288 1.284 5.58 C 0.816 4.872 0.588 3.876 0.588 2.808 C 0.588 0.696 1.656 -0.120000005 2.808 -0.120000005 Z M 3.108 1.344 C 2.4720001 1.344 2.172 1.932 2.172 2.808 C 2.172 4.152 2.736 5.256 3.66 5.256 C 4.392 5.256 4.524 4.452 4.524 3.588 C 4.524 2.088 3.816 1.344 3.108 1.344 Z"/></symbol><symbol id=g7AE160FE6B218E6AB522E63980D40CF0 overflow=visible><path d="M 1.224 -0.120000005 C 1.668 -0.120000005 1.944 0.156 1.944 0.684 L 1.944 4.776 C 1.944 5.112 2.088 5.388 2.412 5.388 C 2.76 5.388 2.88 5.1 2.88 4.776 L 2.88 0.612 C 2.88 0.120000005 3.18 -0.120000005 3.6000001 -0.120000005 C 4.02 -0.120000005 4.32 0.120000005 4.32 0.612 L 4.32 4.776 C 4.32 5.112 4.44 5.388 4.764 5.388 C 5.1 5.388 5.232 5.1 5.232 4.776 L 5.232 0.684 C 5.232 0.156 5.532 -0.120000005 5.976 -0.120000005 C 6.42 -0.120000005 6.696 0.144 6.696 0.672 L 6.696 5.196 C 6.696 6.12 6.276 6.7200003 5.412 6.7200003 C 4.68 6.7200003 4.308 6.288 4.2 5.772 C 4.116 6.264 3.78 6.7200003 3.072 6.7200003 C 2.4 6.7200003 2.076 6.36 1.932 5.772 L 1.932 6.06 C 1.932 6.48 1.644 6.7200003 1.2 6.7200003 C 0.804 6.7200003 0.48000002 6.504 0.48000002 6.06 L 0.48000002 0.672 C 0.48000002 0.144 0.756 -0.120000005 1.224 -0.120000005 Z"/></symbol><symbol id=gB427A7439F058EB92F82F16C414E556A overflow=visible><path d="M 5.52 1.932 C 5.364 1.932 5.232 1.8840001 5.076 1.752 C 4.872 1.572 4.356 1.344 3.78 1.344 C 3.072 1.344 2.4720001 1.74 2.28 2.796 L 5.652 2.796 C 6.096 2.796 6.336 3.048 6.336 3.516 C 6.336 5.184 5.664 6.7200003 3.708 6.7200003 C 2.64 6.7200003 1.908 6.3120003 1.44 5.664 C 0.972 5.0160003 0.78000003 4.1280003 0.78000003 3.252 C 0.78000003 1.332 1.752 -0.120000005 3.708 -0.120000005 C 4.668 -0.120000005 5.34 0.108 5.82 0.528 C 6.096 0.768 6.168 0.936 6.168 1.164 C 6.168 1.5600001 5.916 1.932 5.52 1.932 Z M 4.788 4.008 L 2.292 4.008 C 2.448 4.776 2.904 5.256 3.708 5.256 C 4.512 5.256 4.9440002 4.764 4.9440002 4.248 C 4.9440002 4.056 4.884 4.008 4.788 4.008 Z"/></symbol><symbol id=gC702EA3AED0A9145E9F876A87F52EF81 overflow=visible><path d="M 5.688 6.36 L 3.792 6.36 L 3.792 7.668 C 3.792 8.196 3.54 8.46 3 8.46 C 2.46 8.46 2.208 8.196 2.208 7.668 L 2.208 6.36 L 1.128 6.36 C 0.636 6.36 0.396 6.1080003 0.396 5.616 C 0.396 5.1480002 0.624 4.896 1.104 4.896 L 2.208 4.896 L 2.208 2.88 C 2.208 0.804 2.976 -0.120000005 4.38 -0.120000005 C 5.0160003 -0.120000005 5.592 -0.072 6.132 0.204 C 6.504 0.396 6.624 0.744 6.372 1.176 C 6.168 1.5600001 5.868 1.692 5.4 1.488 C 5.1480002 1.38 4.896 1.344 4.644 1.344 C 4.08 1.344 3.792 1.872 3.792 3.072 L 3.792 4.896 L 5.688 4.896 C 6.168 4.896 6.408 5.16 6.408 5.64 C 6.408 6.1080003 6.168 6.36 5.688 6.36 Z"/></symbol><symbol id=g98493CFC19E36EB6ADBD2B9416F48CBF overflow=visible><path d="M 5.172 6.2400002 L 3.648 2.052 L 2.112 6.252 C 2.028 6.48 1.872 6.6 1.524 6.6 C 0.912 6.6 0.624 6.276 0.888 5.556 L 2.9160001 0.036 L 2.796 -0.288 C 2.64 -0.768 2.52 -0.996 2.1 -1.38 C 1.908 -1.536 1.704 -1.656 1.428 -1.656 C 0.996 -1.656 0.804 -1.932 0.792 -2.364 L 0.792 -2.388 C 0.792 -2.88 1.044 -3.096 1.5600001 -3.096 C 2.004 -3.096 2.628 -2.928 3.168 -2.532 C 3.8040001 -2.052 4.284 -0.792 4.512 -0.120000005 L 6.4440002 5.532 C 6.492 5.712 6.528 5.868 6.528 6 C 6.528 6.42 6.264 6.6 5.7000003 6.6 C 5.4240003 6.6 5.256 6.48 5.172 6.2400002 Z"/></symbol><symbol id=gCF7D89FBA207214DF810E4E36ECCA400 overflow=visible><path d="M 1.608 6.7200003 C 1.068 6.7200003 0.828 6.468 0.828 5.94 L 0.828 -1.488 C 0.828 -2.016 1.08 -2.28 1.62 -2.28 C 2.16 -2.28 2.412 -2.016 2.412 -1.488 L 2.412 1.104 C 2.544 0.348 3.168 -0.120000005 3.9720001 -0.120000005 C 6.048 -0.120000005 6.54 1.776 6.54 3.372 C 6.54 5.232 6.072 6.7200003 4.248 6.7200003 C 3.1560001 6.7200003 2.664 6.096 2.412 5.328 L 2.412 5.94 C 2.412 6.468 2.136 6.7200003 1.608 6.7200003 Z M 3.8040001 5.256 C 4.272 5.256 4.572 5.028 4.7400002 4.668 C 4.908 4.308 4.9440002 3.828 4.9440002 3.3600001 C 4.9440002 2.436 4.788 1.344 3.696 1.344 C 2.928 1.344 2.412 2.16 2.412 2.988 L 2.412 3.72 C 2.412 4.62 3.072 5.256 3.8040001 5.256 Z"/></symbol><symbol id=g74125599FC16DAB87B122488958C9A8 overflow=visible><path d="M 2.58 0.672 L 2.58 2.04 L 3.288 2.808 L 4.824 0.348 C 5.052 -0.036 5.364 -0.120000005 5.784 -0.120000005 C 6.228 -0.120000005 6.672 0.372 6.348 0.888 L 4.392 3.996 L 5.928 5.64 C 6.408 6.156 5.976 6.7200003 5.4 6.7200003 C 5.124 6.7200003 4.872 6.612 4.632 6.372 L 2.58 4.188 L 2.58 8.088 C 2.58 8.616 2.316 8.88 1.788 8.88 C 1.248 8.88 0.984 8.616 0.984 8.088 L 0.984 0.672 C 0.984 0.144 1.248 -0.120000005 1.788 -0.120000005 C 2.316 -0.120000005 2.58 0.144 2.58 0.672 Z"/></symbol><symbol id=g1D3C0C2100A43DB91C82131EC9CB01AB overflow=visible><path d="M 5.988 1.464 L 4.704 1.464 L 4.704 5.064 C 4.704 5.928 4.284 6.36 3.408 6.36 L 1.8840001 6.36 C 1.392 6.36 1.128 6.1080003 1.128 5.6280003 C 1.128 5.1480002 1.392 4.896 1.8840001 4.896 L 2.52 4.896 C 2.9160001 4.896 3.1200001 4.704 3.1200001 4.284 L 3.1200001 1.464 L 1.608 1.464 C 1.128 1.464 0.888 1.212 0.888 0.732 C 0.888 0.252 1.14 0 1.62 0 L 5.976 0 C 6.456 0 6.708 0.252 6.708 0.732 C 6.708 1.212 6.456 1.464 5.988 1.464 Z M 3.8400002 7.452 C 4.464 7.452 4.848 7.788 4.848 8.328 C 4.848 8.868 4.464 9.216 3.8400002 9.216 C 3.216 9.216 2.832 8.868 2.832 8.328 C 2.832 7.788 3.216 7.452 3.8400002 7.452 Z"/></symbol><symbol id=g58A034053C0707D955174AFF6BC38BDD overflow=visible><path d="M 5.592 -0.120000005 C 6.132 -0.120000005 6.372 0.132 6.372 0.66 L 6.372 8.088 C 6.372 8.616 6.12 8.88 5.58 8.88 C 5.04 8.88 4.788 8.616 4.788 8.088 L 4.788 5.496 C 4.656 6.252 4.032 6.7200003 3.228 6.7200003 C 1.152 6.7200003 0.66 4.86 0.66 3.228 C 0.66 1.368 1.128 -0.120000005 2.9520001 -0.120000005 C 4.044 -0.120000005 4.5360003 0.504 4.788 1.272 L 4.788 0.66 C 4.788 0.132 5.064 -0.120000005 5.592 -0.120000005 Z M 3.3960001 1.344 C 2.928 1.344 2.628 1.584 2.4720001 1.944 C 2.304 2.304 2.256 2.772 2.256 3.24 C 2.256 4.164 2.412 5.256 3.504 5.256 C 4.272 5.256 4.788 4.44 4.788 3.612 L 4.788 2.88 C 4.788 1.98 4.164 1.344 3.3960001 1.344 Z"/></symbol><symbol id=g84625F86F5A91CCBD98FD3E1C20FDBD2 overflow=visible><path d="M 2.22 0.42000002 L 2.22 3.792 C 2.22 4.56 2.82 5.7000003 3.684 5.7000003 C 4.548 5.7000003 4.98 4.956 4.98 4.1280003 L 4.98 0.42000002 C 4.98 0.048 5.1480002 -0.120000005 5.52 -0.120000005 C 5.892 -0.120000005 6.06 0.048 6.06 0.42000002 L 6.06 4.44 C 6.06 5.82 5.1480002 6.7200003 3.864 6.7200003 C 2.988 6.7200003 2.448 6.2400002 2.22 5.472 L 2.22 6.18 C 2.22 6.552 2.052 6.7200003 1.6800001 6.7200003 C 1.308 6.7200003 1.14 6.552 1.14 6.18 L 1.14 0.42000002 C 1.14 0.048 1.308 -0.120000005 1.6800001 -0.120000005 C 2.052 -0.120000005 2.22 0.048 2.22 0.42000002 Z"/></symbol><symbol id=gA0C455776013183F65C62FA00DB659B overflow=visible><path d="M 3.6000001 -0.120000005 C 5.46 -0.120000005 6.3 1.332 6.3 3.312 C 6.3 5.292 5.484 6.7200003 3.6000001 6.7200003 C 1.74 6.7200003 0.90000004 5.292 0.90000004 3.312 C 0.90000004 1.332 1.74 -0.120000005 3.6000001 -0.120000005 Z M 3.6000001 0.96000004 C 2.484 0.96000004 1.98 1.9200001 1.98 3.3 C 1.98 4.68 2.448 5.64 3.6000001 5.64 C 4.752 5.64 5.2200003 4.692 5.2200003 3.312 C 5.2200003 1.932 4.716 0.96000004 3.6000001 0.96000004 Z"/></symbol><symbol id=g4E1AA11ADE573EC4FD9816EBF7F28C42 overflow=visible><path d="M 5.748 6.36 L 3.54 6.36 L 3.54 7.92 C 3.54 8.292 3.372 8.46 3 8.46 C 2.628 8.46 2.46 8.292 2.46 7.92 L 2.46 6.36 L 1.056 6.36 C 0.732 6.36 0.564 6.144 0.564 5.82 C 0.564 5.496 0.732 5.28 1.056 5.28 L 2.46 5.28 L 2.46 2.484 C 2.46 0.696 3.228 -0.120000005 4.38 -0.120000005 C 5.052 -0.120000005 5.604 -0.072 6.084 0.18 C 6.384 0.336 6.468 0.612 6.276 0.936 C 6.096 1.2360001 5.856 1.344 5.532 1.164 C 5.16 0.984 4.884 0.96000004 4.56 0.96000004 C 3.888 0.96000004 3.54 1.536 3.54 2.688 L 3.54 5.28 L 5.748 5.28 C 6.072 5.28 6.2400002 5.496 6.2400002 5.82 C 6.2400002 6.144 6.072 6.36 5.748 6.36 Z"/></symbol><symbol id=gB67AB626BA72DA69B1B65382C206CCFD overflow=visible><path d="M 1.62 -0.120000005 C 1.992 -0.120000005 2.16 0.060000002 2.16 0.432 L 2.16 1.2 C 2.448 0.396 3 -0.120000005 3.924 -0.120000005 C 5.88 -0.120000005 6.2400002 1.596 6.2400002 3.072 C 6.2400002 4.8 5.82 6.7200003 3.8040001 6.7200003 C 2.928 6.7200003 2.304 6.192 2.16 5.472 L 2.16 8.34 C 2.16 8.712 1.992 8.88 1.62 8.88 C 1.248 8.88 1.08 8.712 1.08 8.34 L 1.08 0.432 C 1.08 0.060000002 1.248 -0.120000005 1.62 -0.120000005 Z M 3.816 0.96000004 C 2.9520001 0.96000004 2.16 1.704 2.16 2.4720001 L 2.16 3.792 C 2.16 4.56 2.76 5.64 3.624 5.64 C 5.004 5.64 5.16 4.356 5.16 3.144 C 5.16 1.896 4.872 0.96000004 3.816 0.96000004 Z"/></symbol><symbol id=g9B0C0AD8F1AEB228C1E075A06DAB0CCF overflow=visible><path d="M 3.708 2.688 L 3.72 7.8 C 3.72 8.46 3.42 8.76 2.76 8.76 L 1.272 8.76 C 0.948 8.76 0.78000003 8.592 0.78000003 8.268 C 0.78000003 7.9440002 0.948 7.776 1.272 7.776 L 2.16 7.776 C 2.484 7.776 2.64 7.62 2.64 7.296 L 2.628 2.484 C 2.628 0.696 3.3960001 -0.120000005 4.548 -0.120000005 C 5.2200003 -0.120000005 5.772 -0.072 6.252 0.18 C 6.552 0.336 6.636 0.612 6.4440002 0.936 C 6.264 1.2360001 6.024 1.344 5.7000003 1.164 C 5.328 0.984 5.052 0.96000004 4.728 0.96000004 C 4.056 0.96000004 3.708 1.536 3.708 2.688 Z"/></symbol><symbol id=gF230359563E3A81C6A494BE4E8C24E0E overflow=visible><path d="M 1.44 3.42 L 7.2000003 3.42 L 7.2000003 4.5 L 1.44 4.5 C 1.068 4.5 0.90000004 4.3320003 0.90000004 3.96 C 0.90000004 3.588 1.068 3.42 1.44 3.42 Z"/></symbol><symbol id=g3A2E5E0A954DE8439AAF463B454E3773 overflow=visible><path d="M 3.492 5.64 C 3.6000001 5.532 3.6000001 5.412 3.492 5.304 L 2.856 4.668 C 2.748 4.56 2.604 4.5 2.448 4.5 L 0 4.5 L 0 3.42 L 2.448 3.42 C 2.604 3.42 2.748 3.3600001 2.856 3.252 L 3.492 2.616 C 3.6000001 2.5080001 3.6000001 2.388 3.492 2.28 L 2.388 1.176 C 2.136 0.924 2.136 0.66 2.388 0.408 C 2.64 0.156 2.904 0.156 3.1560001 0.408 L 6.024 3.276 C 6.492 3.744 6.492 4.176 6.024 4.644 L 3.1560001 7.512 C 2.904 7.764 2.64 7.764 2.388 7.512 C 2.136 7.26 2.136 6.9960003 2.388 6.744 Z M 4.764 3.552 C 4.5360003 3.3240001 4.32 3.3240001 4.092 3.552 L 4.02 3.624 C 3.78 3.864 3.78 4.056 4.02 4.296 L 4.092 4.368 C 4.32 4.596 4.5360003 4.596 4.764 4.368 L 4.836 4.296 C 5.064 4.068 5.064 3.852 4.836 3.624 Z"/></symbol><symbol id=gE7063D852C91DAB2A7D46C6F07D0629B overflow=visible><path d="M 3.6000001 0.84000003 C 3.9720001 0.84000003 4.14 1.008 4.14 1.38 L 4.14 3.024 L 5.568 2.196 C 5.76 2.088 5.94 2.0640001 6.084 2.16 C 6.192 2.244 6.3 2.364 6.36 2.52 C 6.456 2.796 6.372 2.976 6.1080003 3.132 L 4.68 3.96 L 6.1080003 4.788 C 6.372 4.9440002 6.456 5.124 6.36 5.412 C 6.3 5.556 6.204 5.676 6.084 5.76 C 5.94 5.856 5.76 5.8320003 5.568 5.724 L 4.14 4.896 L 4.14 6.54 C 4.14 6.912 3.9720001 7.08 3.6000001 7.08 C 3.228 7.08 3.06 6.912 3.06 6.54 L 3.06 4.896 L 1.632 5.724 C 1.44 5.8320003 1.26 5.856 1.128 5.76 C 0.996 5.676 0.90000004 5.556 0.852 5.412 C 0.744 5.124 0.828 4.9440002 1.092 4.788 L 2.52 3.96 L 1.092 3.132 C 0.828 2.976 0.744 2.796 0.852 2.52 C 0.90000004 2.364 1.008 2.244 1.128 2.16 C 1.26 2.0640001 1.44 2.088 1.632 2.196 L 3.06 3.024 L 3.06 1.38 C 3.06 1.008 3.228 0.84000003 3.6000001 0.84000003 Z"/></symbol><symbol id=gBCD61CC537844E9A88540E6CBD172274 overflow=visible><path d="M 2.1 0.24000001 L 3.6000001 2.46 L 5.1 0.24000001 C 5.256 0 5.46 -0.120000005 5.712 -0.120000005 C 6.06 -0.120000005 6.456 0.144 6.132 0.588 L 4.236 3.3960001 L 6 6 C 6.324 6.48 5.94 6.7200003 5.592 6.7200003 C 5.316 6.7200003 5.112 6.6 4.956 6.36 L 3.6000001 4.344 L 2.244 6.36 C 2.088 6.588 1.896 6.7200003 1.62 6.7200003 C 1.272 6.7200003 0.876 6.48 1.2 6 L 2.964 3.3960001 L 1.068 0.588 C 0.744 0.144 1.14 -0.120000005 1.488 -0.120000005 C 1.74 -0.120000005 1.944 0.012 2.1 0.24000001 Z"/></symbol></defs></svg></div><p>不管是 <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code> 还是 <code class="font-semibold text-[#aa8bd5]"><code>bool -> bool</code></code>, 两者的类型都是一个已经非常具体的类型, 其 kind 则是 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code><br>为了便于理解, 姑且称呼这些类型为 <em>具体类型</em> (你也可以将它们叫作 <em>full-type</em>, <em>actual-type</em>, <em>standalone-type</em>)<br>这些类型都是很具体的, 其 kind 是相同的 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code><br><br>(当我们站在 kind 这个抽象层上看待 type 时, 应该使用 type 指代具体的 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>i32 -> i32</code></code>, 它们都是 type)<br>(其实站在 type 这个抽象层看待 value 时, 也是一样的道理)<br><br>一句话, type 用来抽象 value, kind 用于抽象 type<br>倘若你要问 <code class="font-semibold text-[#aa8bd5]"><code>true</code></code> 的 kind 是 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code> 吗? 那不对, 你得说 <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code> 的 kind 是 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code> 才对<br><br>你可能要说了:<br>什么鬼啊, 照你这么说岂不是所有的类型都是 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code> 了, 比如 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>fn(i32) -> i32</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;T></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Result&lt;T, E></code></code>…<br>这些类型都是具体类型, 其 kind 难道不都是 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code> 吗?<br><br>没错, 在 rust 中的 <code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;T></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Option&lt;T></code></code>, 它们都是一层的 type, 即其 kind 是 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code><br><strong>但如果是 <code class="font-semibold text-[#aa8bd5]"><code>Vec</code></code> 而不是 <code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;T></code></code> 呢?</strong> 假设这也是某种类型<br><br>你会发现, 你必须提供一个类型 (比如 <code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;i32></code></code> 就是向 <code class="font-semibold text-[#aa8bd5]"><code>Vec</code></code> 提供了 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code> 作为参数), 才能构造出最终的具体类型<br>对于这种特殊类型来说, 其 kind 就是 <code class="font-semibold text-[#aa8bd5]"><code>* -> *</code></code> 了<br><div class="my-4 mx-2 sm:mx-6"><svg style="overflow: visible;" viewbox="0 0 270.3999999999999 230.08" class=typst-doc height=230.08pt width=270.3999999999999pt xmlns=http://www.w3.org/2000/svg xmlns:h5=http://www.w3.org/1999/xhtml xmlns:xlink=http://www.w3.org/1999/xlink><g><g transform="translate(0 -0.5)"><path d="M 0 0 L 0 231.08" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(171.19999999999996 -0.5)"><path d="M 0 0 L 0 231.08" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(270.3999999999999 -0.5)"><path d="M 0 0 L 0 231.08" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 0)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 28.76)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 57.52)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 86.28)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 115.04)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 143.79999999999998)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 172.56)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 201.32)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(-0.5 230.08)"><path d="M 0 0 L 271.4 0" class=typst-shape fill=none stroke=#ffffff stroke-linecap=butt stroke-linejoin=miter stroke-miterlimit=4 stroke-width=1 /></g><g transform="translate(10 18.76)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gC702EA3AED0A9145E9F876A87F52EF81 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#g98493CFC19E36EB6ADBD2B9416F48CBF /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gCF7D89FBA207214DF810E4E36ECCA400 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#gB427A7439F058EB92F82F16C414E556A /></g></g><g transform="translate(181.19999999999996 18.76)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g74125599FC16DAB87B122488958C9A8 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#g1D3C0C2100A43DB91C82131EC9CB01AB /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gB0AD4B9E45FCD3A39DF21B876F9D786A /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g58A034053C0707D955174AFF6BC38BDD /></g></g><g transform="translate(10 47.52)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gC3CBCDB8A6F9490720179C1F6FA32B7 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gF7E460A2E2A21CAD40F8CA885A1603B3 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gB0718933815C0F2424FC7633F36A37E6 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#gEDC976741B0D54FB5FEB878B27BF390B /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g228948D071A8655BC1F24DE76D8DD151 /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g36AD9F5E8BAE54C69E660298E60C76EE /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 47.52)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 76.28)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gC3CBCDB8A6F9490720179C1F6FA32B7 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gF7E460A2E2A21CAD40F8CA885A1603B3 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gB0718933815C0F2424FC7633F36A37E6 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#gE3C67593FDC4342F4ABBA8C148EC59E9 /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 76.28)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gF230359563E3A81C6A494BE4E8C24E0E /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g3A2E5E0A954DE8439AAF463B454E3773 /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 105.04)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g1325863C946970583F0F30F43159F652 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gC8D1F4B3162229B3A79D21128D7AE9C1 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#gEDC976741B0D54FB5FEB878B27BF390B /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g84625F86F5A91CCBD98FD3E1C20FDBD2 /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#gEDC976741B0D54FB5FEB878B27BF390B /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#g228948D071A8655BC1F24DE76D8DD151 /><use fill=#ffffff fill-rule=nonzero x=64.80000000000001 xlink:href=#g36AD9F5E8BAE54C69E660298E60C76EE /><use fill=#ffffff fill-rule=nonzero x=72.00000000000001 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 105.04)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 133.79999999999998)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g1325863C946970583F0F30F43159F652 /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gC8D1F4B3162229B3A79D21128D7AE9C1 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#gEDC976741B0D54FB5FEB878B27BF390B /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g84625F86F5A91CCBD98FD3E1C20FDBD2 /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#gE3C67593FDC4342F4ABBA8C148EC59E9 /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 133.79999999999998)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gF230359563E3A81C6A494BE4E8C24E0E /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g3A2E5E0A954DE8439AAF463B454E3773 /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 162.56)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g2B828878A9A3C73DAC2437F8F84AAB6F /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gF7E460A2E2A21CAD40F8CA885A1603B3 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g7EC3437544802741FDFF464AC24F7616 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g24953FDE2016845F3AA35B135497832F /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#g9B0C0AD8F1AEB228C1E075A06DAB0CCF /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#g7C1A9D5B9D088A582670715B1F160881 /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=64.80000000000001 xlink:href=#gC7D2E548962E9978211011CB049CF7F5 /><use fill=#ffffff fill-rule=nonzero x=72.00000000000001 xlink:href=#gEDC976741B0D54FB5FEB878B27BF390B /><use fill=#ffffff fill-rule=nonzero x=79.20000000000002 xlink:href=#g84625F86F5A91CCBD98FD3E1C20FDBD2 /><use fill=#ffffff fill-rule=nonzero x=86.40000000000002 xlink:href=#gF66F70E570014D69E565237754049617 /><use fill=#ffffff fill-rule=nonzero x=93.60000000000002 xlink:href=#gA4AE1EFC2D46BA809ADD3F023DD67910 /><use fill=#ffffff fill-rule=nonzero x=108.00000000000003 xlink:href=#g8F7C22B7CDAC394974B44C0CA68B68A8 /><use fill=#ffffff fill-rule=nonzero x=115.20000000000003 xlink:href=#gC7D2E548962E9978211011CB049CF7F5 /><use fill=#ffffff fill-rule=nonzero x=122.40000000000003 xlink:href=#gC7D2E548962E9978211011CB049CF7F5 /><use fill=#ffffff fill-rule=nonzero x=129.60000000000002 xlink:href=#gA0C455776013183F65C62FA00DB659B /><use fill=#ffffff fill-rule=nonzero x=136.8 xlink:href=#gC7D2E548962E9978211011CB049CF7F5 /><use fill=#ffffff fill-rule=nonzero x=144 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 162.56)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 191.32)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g2B828878A9A3C73DAC2437F8F84AAB6F /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gF7E460A2E2A21CAD40F8CA885A1603B3 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g7EC3437544802741FDFF464AC24F7616 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g24953FDE2016845F3AA35B135497832F /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#g9B0C0AD8F1AEB228C1E075A06DAB0CCF /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#g7C1A9D5B9D088A582670715B1F160881 /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=64.80000000000001 xlink:href=#gC7D2E548962E9978211011CB049CF7F5 /><use fill=#ffffff fill-rule=nonzero x=72.00000000000001 xlink:href=#gEDC976741B0D54FB5FEB878B27BF390B /><use fill=#ffffff fill-rule=nonzero x=79.20000000000002 xlink:href=#g84625F86F5A91CCBD98FD3E1C20FDBD2 /><use fill=#ffffff fill-rule=nonzero x=86.40000000000002 xlink:href=#gF66F70E570014D69E565237754049617 /><use fill=#ffffff fill-rule=nonzero x=93.60000000000002 xlink:href=#gA4AE1EFC2D46BA809ADD3F023DD67910 /><use fill=#ffffff fill-rule=nonzero x=108.00000000000003 xlink:href=#gE3C67593FDC4342F4ABBA8C148EC59E9 /><use fill=#ffffff fill-rule=nonzero x=115.20000000000003 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 191.32)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gF230359563E3A81C6A494BE4E8C24E0E /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g3A2E5E0A954DE8439AAF463B454E3773 /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g><g transform="translate(10 220.08)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#g2B828878A9A3C73DAC2437F8F84AAB6F /><use fill=#ffffff fill-rule=nonzero x=7.2 xlink:href=#gF7E460A2E2A21CAD40F8CA885A1603B3 /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#g7EC3437544802741FDFF464AC24F7616 /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g24953FDE2016845F3AA35B135497832F /><use fill=#ffffff fill-rule=nonzero x=28.8 xlink:href=#g9B0C0AD8F1AEB228C1E075A06DAB0CCF /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#g4E1AA11ADE573EC4FD9816EBF7F28C42 /><use fill=#ffffff fill-rule=nonzero x=43.2 xlink:href=#g65A59F5B41D17021074281D703D1BC4A /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#gE3C67593FDC4342F4ABBA8C148EC59E9 /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#gA4AE1EFC2D46BA809ADD3F023DD67910 /><use fill=#ffffff fill-rule=nonzero x=72.00000000000001 xlink:href=#gE3C67593FDC4342F4ABBA8C148EC59E9 /><use fill=#ffffff fill-rule=nonzero x=79.20000000000002 xlink:href=#g1D999C9010B11D2ACE701A5DA645D818 /></g></g><g transform="translate(181.19999999999996 220.08)"><g transform="scale(1, -1)" class=typst-text><use fill=#ffffff fill-rule=nonzero x=0 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /><use fill=#ffffff fill-rule=nonzero x=14.4 xlink:href=#gF230359563E3A81C6A494BE4E8C24E0E /><use fill=#ffffff fill-rule=nonzero x=21.6 xlink:href=#g3A2E5E0A954DE8439AAF463B454E3773 /><use fill=#ffffff fill-rule=nonzero x=36 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /><use fill=#ffffff fill-rule=nonzero x=50.400000000000006 xlink:href=#gF230359563E3A81C6A494BE4E8C24E0E /><use fill=#ffffff fill-rule=nonzero x=57.60000000000001 xlink:href=#g3A2E5E0A954DE8439AAF463B454E3773 /><use fill=#ffffff fill-rule=nonzero x=72.00000000000001 xlink:href=#gE7063D852C91DAB2A7D46C6F07D0629B /></g></g></g><defs id=glyph><symbol id=gC702EA3AED0A9145E9F876A87F52EF81 overflow=visible><path d="M 5.688 6.36 L 3.792 6.36 L 3.792 7.668 C 3.792 8.196 3.54 8.46 3 8.46 C 2.46 8.46 2.208 8.196 2.208 7.668 L 2.208 6.36 L 1.128 6.36 C 0.636 6.36 0.396 6.1080003 0.396 5.616 C 0.396 5.1480002 0.624 4.896 1.104 4.896 L 2.208 4.896 L 2.208 2.88 C 2.208 0.804 2.976 -0.120000005 4.38 -0.120000005 C 5.0160003 -0.120000005 5.592 -0.072 6.132 0.204 C 6.504 0.396 6.624 0.744 6.372 1.176 C 6.168 1.5600001 5.868 1.692 5.4 1.488 C 5.1480002 1.38 4.896 1.344 4.644 1.344 C 4.08 1.344 3.792 1.872 3.792 3.072 L 3.792 4.896 L 5.688 4.896 C 6.168 4.896 6.408 5.16 6.408 5.64 C 6.408 6.1080003 6.168 6.36 5.688 6.36 Z"/></symbol><symbol id=g98493CFC19E36EB6ADBD2B9416F48CBF overflow=visible><path d="M 5.172 6.2400002 L 3.648 2.052 L 2.112 6.252 C 2.028 6.48 1.872 6.6 1.524 6.6 C 0.912 6.6 0.624 6.276 0.888 5.556 L 2.9160001 0.036 L 2.796 -0.288 C 2.64 -0.768 2.52 -0.996 2.1 -1.38 C 1.908 -1.536 1.704 -1.656 1.428 -1.656 C 0.996 -1.656 0.804 -1.932 0.792 -2.364 L 0.792 -2.388 C 0.792 -2.88 1.044 -3.096 1.5600001 -3.096 C 2.004 -3.096 2.628 -2.928 3.168 -2.532 C 3.8040001 -2.052 4.284 -0.792 4.512 -0.120000005 L 6.4440002 5.532 C 6.492 5.712 6.528 5.868 6.528 6 C 6.528 6.42 6.264 6.6 5.7000003 6.6 C 5.4240003 6.6 5.256 6.48 5.172 6.2400002 Z"/></symbol><symbol id=gCF7D89FBA207214DF810E4E36ECCA400 overflow=visible><path d="M 1.608 6.7200003 C 1.068 6.7200003 0.828 6.468 0.828 5.94 L 0.828 -1.488 C 0.828 -2.016 1.08 -2.28 1.62 -2.28 C 2.16 -2.28 2.412 -2.016 2.412 -1.488 L 2.412 1.104 C 2.544 0.348 3.168 -0.120000005 3.9720001 -0.120000005 C 6.048 -0.120000005 6.54 1.776 6.54 3.372 C 6.54 5.232 6.072 6.7200003 4.248 6.7200003 C 3.1560001 6.7200003 2.664 6.096 2.412 5.328 L 2.412 5.94 C 2.412 6.468 2.136 6.7200003 1.608 6.7200003 Z M 3.8040001 5.256 C 4.272 5.256 4.572 5.028 4.7400002 4.668 C 4.908 4.308 4.9440002 3.828 4.9440002 3.3600001 C 4.9440002 2.436 4.788 1.344 3.696 1.344 C 2.928 1.344 2.412 2.16 2.412 2.988 L 2.412 3.72 C 2.412 4.62 3.072 5.256 3.8040001 5.256 Z"/></symbol><symbol id=gB427A7439F058EB92F82F16C414E556A overflow=visible><path d="M 5.52 1.932 C 5.364 1.932 5.232 1.8840001 5.076 1.752 C 4.872 1.572 4.356 1.344 3.78 1.344 C 3.072 1.344 2.4720001 1.74 2.28 2.796 L 5.652 2.796 C 6.096 2.796 6.336 3.048 6.336 3.516 C 6.336 5.184 5.664 6.7200003 3.708 6.7200003 C 2.64 6.7200003 1.908 6.3120003 1.44 5.664 C 0.972 5.0160003 0.78000003 4.1280003 0.78000003 3.252 C 0.78000003 1.332 1.752 -0.120000005 3.708 -0.120000005 C 4.668 -0.120000005 5.34 0.108 5.82 0.528 C 6.096 0.768 6.168 0.936 6.168 1.164 C 6.168 1.5600001 5.916 1.932 5.52 1.932 Z M 4.788 4.008 L 2.292 4.008 C 2.448 4.776 2.904 5.256 3.708 5.256 C 4.512 5.256 4.9440002 4.764 4.9440002 4.248 C 4.9440002 4.056 4.884 4.008 4.788 4.008 Z"/></symbol><symbol id=g74125599FC16DAB87B122488958C9A8 overflow=visible><path d="M 2.58 0.672 L 2.58 2.04 L 3.288 2.808 L 4.824 0.348 C 5.052 -0.036 5.364 -0.120000005 5.784 -0.120000005 C 6.228 -0.120000005 6.672 0.372 6.348 0.888 L 4.392 3.996 L 5.928 5.64 C 6.408 6.156 5.976 6.7200003 5.4 6.7200003 C 5.124 6.7200003 4.872 6.612 4.632 6.372 L 2.58 4.188 L 2.58 8.088 C 2.58 8.616 2.316 8.88 1.788 8.88 C 1.248 8.88 0.984 8.616 0.984 8.088 L 0.984 0.672 C 0.984 0.144 1.248 -0.120000005 1.788 -0.120000005 C 2.316 -0.120000005 2.58 0.144 2.58 0.672 Z"/></symbol><symbol id=g1D3C0C2100A43DB91C82131EC9CB01AB overflow=visible><path d="M 5.988 1.464 L 4.704 1.464 L 4.704 5.064 C 4.704 5.928 4.284 6.36 3.408 6.36 L 1.8840001 6.36 C 1.392 6.36 1.128 6.1080003 1.128 5.6280003 C 1.128 5.1480002 1.392 4.896 1.8840001 4.896 L 2.52 4.896 C 2.9160001 4.896 3.1200001 4.704 3.1200001 4.284 L 3.1200001 1.464 L 1.608 1.464 C 1.128 1.464 0.888 1.212 0.888 0.732 C 0.888 0.252 1.14 0 1.62 0 L 5.976 0 C 6.456 0 6.708 0.252 6.708 0.732 C 6.708 1.212 6.456 1.464 5.988 1.464 Z M 3.8400002 7.452 C 4.464 7.452 4.848 7.788 4.848 8.328 C 4.848 8.868 4.464 9.216 3.8400002 9.216 C 3.216 9.216 2.832 8.868 2.832 8.328 C 2.832 7.788 3.216 7.452 3.8400002 7.452 Z"/></symbol><symbol id=gB0AD4B9E45FCD3A39DF21B876F9D786A overflow=visible><path d="M 2.448 0.672 L 2.448 3.78 C 2.448 4.512 2.964 5.232 3.732 5.232 C 4.464 5.232 4.752 4.584 4.752 3.9720001 L 4.752 0.672 C 4.752 0.144 5.0160003 -0.120000005 5.544 -0.120000005 C 6.084 -0.120000005 6.336 0.144 6.336 0.672 L 6.336 4.308 C 6.336 5.688 5.484 6.7200003 4.008 6.7200003 C 3.204 6.7200003 2.652 6.2400002 2.4 5.4240003 L 2.4 5.94 C 2.4 6.468 2.088 6.7200003 1.608 6.7200003 C 1.116 6.7200003 0.864 6.468 0.864 5.94 L 0.864 0.672 C 0.864 0.144 1.116 -0.120000005 1.656 -0.120000005 C 2.184 -0.120000005 2.448 0.144 2.448 0.672 Z"/></symbol><symbol id=g58A034053C0707D955174AFF6BC38BDD overflow=visible><path d="M 5.592 -0.120000005 C 6.132 -0.120000005 6.372 0.132 6.372 0.66 L 6.372 8.088 C 6.372 8.616 6.12 8.88 5.58 8.88 C 5.04 8.88 4.788 8.616 4.788 8.088 L 4.788 5.496 C 4.656 6.252 4.032 6.7200003 3.228 6.7200003 C 1.152 6.7200003 0.66 4.86 0.66 3.228 C 0.66 1.368 1.128 -0.120000005 2.9520001 -0.120000005 C 4.044 -0.120000005 4.5360003 0.504 4.788 1.272 L 4.788 0.66 C 4.788 0.132 5.064 -0.120000005 5.592 -0.120000005 Z M 3.3960001 1.344 C 2.928 1.344 2.628 1.584 2.4720001 1.944 C 2.304 2.304 2.256 2.772 2.256 3.24 C 2.256 4.164 2.412 5.256 3.504 5.256 C 4.272 5.256 4.788 4.44 4.788 3.612 L 4.788 2.88 C 4.788 1.98 4.164 1.344 3.3960001 1.344 Z"/></symbol><symbol id=gC3CBCDB8A6F9490720179C1F6FA32B7 overflow=visible><path d="M 0.768 8.2560005 L 2.844 0.456 C 2.9520001 0.072 3.204 -0.120000005 3.6000001 -0.120000005 C 4.02 -0.120000005 4.248 0.072 4.356 0.456 L 6.432 8.2560005 C 6.5160003 8.58 6.4440002 8.88 5.976 8.88 C 5.652 8.88 5.436 8.736 5.352 8.46 L 3.78 2.22 C 3.684 1.848 3.516 1.848 3.42 2.22 L 1.848 8.46 C 1.764 8.736 1.548 8.88 1.224 8.88 C 0.756 8.88 0.684 8.58 0.768 8.2560005 Z"/></symbol><symbol id=gF7E460A2E2A21CAD40F8CA885A1603B3 overflow=visible><path d="M 5.508 1.584 C 5.376 1.584 5.328 1.548 5.196 1.44 C 4.956 1.248 4.56 0.96000004 3.8400002 0.96000004 C 2.82 0.96000004 2.112 1.596 1.98 2.88 L 5.616 2.88 C 5.952 2.88 6.18 3.1560001 6.18 3.444 C 6.18 5.328 5.58 6.7200003 3.66 6.7200003 C 1.608 6.7200003 0.876 5.088 0.876 3.264 C 0.876 1.188 1.968 -0.120000005 3.828 -0.120000005 C 4.632 -0.120000005 5.268 0.120000005 5.784 0.6 C 5.976 0.792 6.0360003 0.912 6.0360003 1.056 C 6.0360003 1.332 5.808 1.584 5.508 1.584 Z M 4.908 3.8400002 L 1.98 3.8400002 C 2.112 4.896 2.664 5.64 3.66 5.64 C 4.56 5.64 5.1 4.908 5.1 4.236 C 5.1 3.9 4.992 3.8400002 4.908 3.8400002 Z"/></symbol><symbol id=gB0718933815C0F2424FC7633F36A37E6 overflow=visible><path d="M 0.96000004 3.288 C 0.96000004 0.948 2.196 -0.120000005 3.96 -0.120000005 C 4.668 -0.120000005 5.412 -0.060000002 5.8320003 0.456 C 6.156 0.84000003 6.1080003 1.128 5.916 1.32 C 5.64 1.548 5.34 1.488 5.1480002 1.296 C 4.908 1.056 4.404 0.96000004 3.984 0.96000004 C 2.892 0.96000004 2.04 1.776 2.04 3.348 C 2.04 4.884 2.844 5.64 3.996 5.64 C 4.704 5.64 5.124 5.376 5.304 5.1 C 5.448 4.86 5.724 4.8 6.012 4.98 C 6.288 5.136 6.36 5.412 6.132 5.784 C 5.844 6.264 5.136 6.7200003 3.924 6.7200003 C 2.328 6.7200003 0.96000004 5.748 0.96000004 3.288 Z"/></symbol><symbol id=g65A59F5B41D17021074281D703D1BC4A overflow=visible><path d="M 1.5600001 3.096 L 5.292 1.224 C 5.88 0.924 6.18 1.14 6.18 1.704 C 6.18 2.028 6.072 2.184 5.88 2.28 L 2.832 3.744 C 2.604 3.852 2.604 4.068 2.832 4.176 L 5.88 5.676 C 6.072 5.772 6.18 5.928 6.18 6.252 C 6.18 6.816 5.88 6.9960003 5.292 6.696 L 1.5600001 4.824 C 1.188 4.644 1.02 4.38 1.02 3.96 C 1.02 3.54 1.188 3.276 1.5600001 3.096 Z"/></symbol><symbol id=gEDC976741B0D54FB5FEB878B27BF390B overflow=visible><path d="M 6.144 1.08 L 4.44 1.08 L 4.44 5.4 C 4.44 6.06 4.14 6.36 3.48 6.36 L 1.788 6.36 C 1.464 6.36 1.26 6.144 1.26 5.82 C 1.26 5.496 1.464 5.28 1.788 5.28 L 2.88 5.28 C 3.204 5.28 3.3600001 5.124 3.3600001 4.8 L 3.3600001 1.08 L 1.536 1.08 C 1.212 1.08 1.02 0.864 1.02 0.54 C 1.02 0.216 1.212 0 1.536 0 L 6.144 0 C 6.468 0 6.66 0.216 6.66 0.54 C 6.66 0.864 6.468 1.08 6.144 1.08 Z M 3.8400002 7.548 C 4.368 7.548 4.692 7.836 4.692 8.304 C 4.692 8.784 4.368 9.084 3.8400002 9.084 C 3.312 9.084 2.988 8.784 2.988 8.304 C 2.988 7.836 3.312 7.548 3.8400002 7.548 Z"/></symbol><symbol id=g228948D071A8655BC1F24DE76D8DD151 overflow=visible><path d="M 1.212 0.252 C 1.752 0.012 2.58 -0.120000005 3.264 -0.120000005 C 5.184 -0.120000005 6.2400002 0.912 6.2400002 2.448 C 6.2400002 3.66 5.724 4.632 4.512 4.728 C 5.436 4.884 5.844 5.772 5.844 6.696 C 5.844 8.328 4.464 8.88 3.06 8.88 C 2.388 8.88 1.728 8.76 1.404 8.532001 C 1.104 8.328 1.0320001 8.016 1.164 7.776 C 1.308 7.488 1.62 7.38 1.86 7.512 C 2.232 7.716 2.604 7.8 3.048 7.8 C 3.816 7.8 4.764 7.548 4.764 6.588 C 4.764 5.436 3.432 5.124 2.604 5.124 C 2.124 5.124 1.9200001 4.968 1.9200001 4.596 C 1.9200001 4.176 2.172 4.008 2.46 4.044 C 3.48 4.104 5.16 3.96 5.16 2.7120001 C 5.16 1.548 4.416 0.96000004 3.264 0.96000004 C 2.748 0.96000004 2.16 1.092 1.728 1.272 C 1.308 1.452 1.0320001 1.296 0.90000004 1.008 C 0.756 0.684 0.888 0.384 1.212 0.252 Z"/></symbol><symbol id=g36AD9F5E8BAE54C69E660298E60C76EE overflow=visible><path d="M 1.632 0 L 5.9040003 0 C 6.276 0 6.4440002 0.168 6.4440002 0.54 C 6.4440002 0.912 6.276 1.08 5.9040003 1.08 L 2.82 1.08 C 2.544 1.08 2.532 1.212 2.616 1.296 L 4.7400002 3.552 C 5.544 4.416 6.216 5.448 6.216 6.4440002 C 6.216 8.364 4.968 8.88 3.468 8.88 C 2.556 8.88 1.956 8.748 1.44 8.376 C 1.2 8.196 1.092 7.896 1.2360001 7.644 C 1.392 7.368 1.704 7.212 1.992 7.392 C 2.388 7.632 2.796 7.8 3.432 7.8 C 4.392 7.8 5.136 7.428 5.136 6.3120003 C 5.136 5.508 4.344 4.644 3.828 4.104 L 1.164 1.344 C 0.984 1.164 0.912 0.948 0.912 0.696 C 0.912 0.228 1.164 0 1.632 0 Z"/></symbol><symbol id=g1D999C9010B11D2ACE701A5DA645D818 overflow=visible><path d="M 5.64 3.096 C 6.012 3.276 6.18 3.54 6.18 3.96 C 6.18 4.38 6.012 4.644 5.64 4.824 L 1.908 6.696 C 1.32 6.9960003 1.02 6.816 1.02 6.252 C 1.02 5.928 1.128 5.772 1.32 5.676 L 4.368 4.176 C 4.596 4.068 4.596 3.852 4.368 3.744 L 1.32 2.28 C 1.128 2.184 1.02 2.028 1.02 1.704 C 1.02 1.14 1.32 0.924 1.908 1.224 Z"/></symbol><symbol id=gE7063D852C91DAB2A7D46C6F07D0629B overflow=visible><path d="M 3.6000001 0.84000003 C 3.9720001 0.84000003 4.14 1.008 4.14 1.38 L 4.14 3.024 L 5.568 2.196 C 5.76 2.088 5.94 2.0640001 6.084 2.16 C 6.192 2.244 6.3 2.364 6.36 2.52 C 6.456 2.796 6.372 2.976 6.1080003 3.132 L 4.68 3.96 L 6.1080003 4.788 C 6.372 4.9440002 6.456 5.124 6.36 5.412 C 6.3 5.556 6.204 5.676 6.084 5.76 C 5.94 5.856 5.76 5.8320003 5.568 5.724 L 4.14 4.896 L 4.14 6.54 C 4.14 6.912 3.9720001 7.08 3.6000001 7.08 C 3.228 7.08 3.06 6.912 3.06 6.54 L 3.06 4.896 L 1.632 5.724 C 1.44 5.8320003 1.26 5.856 1.128 5.76 C 0.996 5.676 0.90000004 5.556 0.852 5.412 C 0.744 5.124 0.828 4.9440002 1.092 4.788 L 2.52 3.96 L 1.092 3.132 C 0.828 2.976 0.744 2.796 0.852 2.52 C 0.90000004 2.364 1.008 2.244 1.128 2.16 C 1.26 2.0640001 1.44 2.088 1.632 2.196 L 3.06 3.024 L 3.06 1.38 C 3.06 1.008 3.228 0.84000003 3.6000001 0.84000003 Z"/></symbol><symbol id=gE3C67593FDC4342F4ABBA8C148EC59E9 overflow=visible><path d="M 1.416 7.416 C 1.2360001 6.756 1.488 6.54 1.908 6.54 C 2.256 6.54 2.448 6.696 2.544 7.02 C 2.7 7.5 3.108 7.8 3.816 7.8 C 4.632 7.8 5.124 7.416 5.124 6.612 C 5.124 5.808 4.644 5.544 3.9720001 5.1 C 3.432 4.728 3.072 4.188 3.012 3.576 C 2.964 3.084 3.144 2.88 3.5640001 2.88 C 3.936 2.88 4.104 3.048 4.188 3.42 C 4.272 3.912 4.5360003 4.236 4.956 4.5360003 C 5.532 4.98 6.204 5.508 6.204 6.624 C 6.204 8.244 5.292 8.88 3.816 8.88 C 2.604 8.88 1.704 8.46 1.416 7.416 Z M 2.688 0.804 C 2.688 0.288 3.084 -0.120000005 3.6000001 -0.120000005 C 4.116 -0.120000005 4.524 0.288 4.524 0.804 C 4.524 1.32 4.116 1.716 3.6000001 1.716 C 3.084 1.716 2.688 1.32 2.688 0.804 Z"/></symbol><symbol id=gF230359563E3A81C6A494BE4E8C24E0E overflow=visible><path d="M 1.44 3.42 L 7.2000003 3.42 L 7.2000003 4.5 L 1.44 4.5 C 1.068 4.5 0.90000004 4.3320003 0.90000004 3.96 C 0.90000004 3.588 1.068 3.42 1.44 3.42 Z"/></symbol><symbol id=g3A2E5E0A954DE8439AAF463B454E3773 overflow=visible><path d="M 3.492 5.64 C 3.6000001 5.532 3.6000001 5.412 3.492 5.304 L 2.856 4.668 C 2.748 4.56 2.604 4.5 2.448 4.5 L 0 4.5 L 0 3.42 L 2.448 3.42 C 2.604 3.42 2.748 3.3600001 2.856 3.252 L 3.492 2.616 C 3.6000001 2.5080001 3.6000001 2.388 3.492 2.28 L 2.388 1.176 C 2.136 0.924 2.136 0.66 2.388 0.408 C 2.64 0.156 2.904 0.156 3.1560001 0.408 L 6.024 3.276 C 6.492 3.744 6.492 4.176 6.024 4.644 L 3.1560001 7.512 C 2.904 7.764 2.64 7.764 2.388 7.512 C 2.136 7.26 2.136 6.9960003 2.388 6.744 Z M 4.764 3.552 C 4.5360003 3.3240001 4.32 3.3240001 4.092 3.552 L 4.02 3.624 C 3.78 3.864 3.78 4.056 4.02 4.296 L 4.092 4.368 C 4.32 4.596 4.5360003 4.596 4.764 4.368 L 4.836 4.296 C 5.064 4.068 5.064 3.852 4.836 3.624 Z"/></symbol><symbol id=g1325863C946970583F0F30F43159F652 overflow=visible><path d="M 3.6000001 0.96000004 C 2.832 0.96000004 2.388 1.536 2.148 2.256 C 1.896 2.964 1.836 3.816 1.836 4.392 C 1.836 4.956 1.896 5.796 2.148 6.5160003 C 2.388 7.224 2.832 7.8 3.6000001 7.8 C 5.136 7.8 5.364 5.52 5.364 4.404 C 5.364 3.252 5.136 0.96000004 3.6000001 0.96000004 Z M 3.6000001 -0.120000005 C 4.8 -0.120000005 5.496 0.528 5.916 1.428 C 6.336 2.328 6.4440002 3.456 6.4440002 4.416 C 6.4440002 6.3 6 8.88 3.6000001 8.88 C 1.164 8.88 0.756 6.264 0.756 4.404 C 0.756 2.484 1.2 -0.120000005 3.6000001 -0.120000005 Z"/></symbol><symbol id=gC8D1F4B3162229B3A79D21128D7AE9C1 overflow=visible><path d="M 1.62 6.7200003 C 1.248 6.7200003 1.08 6.54 1.08 6.168 L 1.08 -1.74 C 1.08 -2.112 1.248 -2.28 1.62 -2.28 C 1.992 -2.28 2.16 -2.112 2.16 -1.74 L 2.16 1.128 C 2.304 0.408 2.928 -0.120000005 3.8040001 -0.120000005 C 5.82 -0.120000005 6.2400002 1.8000001 6.2400002 3.528 C 6.2400002 5.028 5.88 6.7200003 3.924 6.7200003 C 3 6.7200003 2.448 6.204 2.16 5.4 L 2.16 6.168 C 2.16 6.54 1.992 6.7200003 1.62 6.7200003 Z M 3.816 5.64 C 4.872 5.64 5.16 4.704 5.16 3.456 C 5.16 2.244 5.004 0.96000004 3.624 0.96000004 C 2.76 0.96000004 2.16 2.04 2.16 2.808 L 2.16 4.1280003 C 2.16 4.896 2.9520001 5.64 3.816 5.64 Z"/></symbol><symbol id=g4E1AA11ADE573EC4FD9816EBF7F28C42 overflow=visible><path d="M 5.748 6.36 L 3.54 6.36 L 3.54 7.92 C 3.54 8.292 3.372 8.46 3 8.46 C 2.628 8.46 2.46 8.292 2.46 7.92 L 2.46 6.36 L 1.056 6.36 C 0.732 6.36 0.564 6.144 0.564 5.82 C 0.564 5.496 0.732 5.28 1.056 5.28 L 2.46 5.28 L 2.46 2.484 C 2.46 0.696 3.228 -0.120000005 4.38 -0.120000005 C 5.052 -0.120000005 5.604 -0.072 6.084 0.18 C 6.384 0.336 6.468 0.612 6.276 0.936 C 6.096 1.2360001 5.856 1.344 5.532 1.164 C 5.16 0.984 4.884 0.96000004 4.56 0.96000004 C 3.888 0.96000004 3.54 1.536 3.54 2.688 L 3.54 5.28 L 5.748 5.28 C 6.072 5.28 6.2400002 5.496 6.2400002 5.82 C 6.2400002 6.144 6.072 6.36 5.748 6.36 Z"/></symbol><symbol id=gA0C455776013183F65C62FA00DB659B overflow=visible><path d="M 3.6000001 -0.120000005 C 5.46 -0.120000005 6.3 1.332 6.3 3.312 C 6.3 5.292 5.484 6.7200003 3.6000001 6.7200003 C 1.74 6.7200003 0.90000004 5.292 0.90000004 3.312 C 0.90000004 1.332 1.74 -0.120000005 3.6000001 -0.120000005 Z M 3.6000001 0.96000004 C 2.484 0.96000004 1.98 1.9200001 1.98 3.3 C 1.98 4.68 2.448 5.64 3.6000001 5.64 C 4.752 5.64 5.2200003 4.692 5.2200003 3.312 C 5.2200003 1.932 4.716 0.96000004 3.6000001 0.96000004 Z"/></symbol><symbol id=g84625F86F5A91CCBD98FD3E1C20FDBD2 overflow=visible><path d="M 2.22 0.42000002 L 2.22 3.792 C 2.22 4.56 2.82 5.7000003 3.684 5.7000003 C 4.548 5.7000003 4.98 4.956 4.98 4.1280003 L 4.98 0.42000002 C 4.98 0.048 5.1480002 -0.120000005 5.52 -0.120000005 C 5.892 -0.120000005 6.06 0.048 6.06 0.42000002 L 6.06 4.44 C 6.06 5.82 5.1480002 6.7200003 3.864 6.7200003 C 2.988 6.7200003 2.448 6.2400002 2.22 5.472 L 2.22 6.18 C 2.22 6.552 2.052 6.7200003 1.6800001 6.7200003 C 1.308 6.7200003 1.14 6.552 1.14 6.18 L 1.14 0.42000002 C 1.14 0.048 1.308 -0.120000005 1.6800001 -0.120000005 C 2.052 -0.120000005 2.22 0.048 2.22 0.42000002 Z"/></symbol><symbol id=g2B828878A9A3C73DAC2437F8F84AAB6F overflow=visible><path d="M 2.184 4.92 L 2.184 7.2000003 C 2.184 7.524 2.34 7.6800003 2.664 7.6800003 L 3.924 7.6800003 C 4.788 7.6800003 5.484 7.224 5.484 6.3 C 5.484 5.856 5.304 5.496 5.028 5.268 C 4.7400002 5.04 4.356 4.92 3.924 4.92 Z M 2.184 3.8400002 L 3.6000001 3.8400002 L 5.352 0.24000001 C 5.484 0 5.664 -0.120000005 6 -0.120000005 C 6.468 -0.120000005 6.612 0.108 6.372 0.588 L 4.728 3.936 C 5.82 4.188 6.6 5.0160003 6.6 6.3 C 6.6 7.872 5.4240003 8.76 3.924 8.76 L 2.0640001 8.76 C 1.404 8.76 1.104 8.46 1.104 7.8 L 1.104 0.42000002 C 1.104 0.048 1.272 -0.120000005 1.644 -0.120000005 C 2.016 -0.120000005 2.184 0.048 2.184 0.42000002 Z"/></symbol><symbol id=g7EC3437544802741FDFF464AC24F7616 overflow=visible><path d="M 3.612 -0.120000005 C 5.0160003 -0.120000005 6.2400002 0.384 6.2400002 1.788 C 6.2400002 3.3240001 4.8120003 3.72 3.6000001 3.9720001 C 3.084 4.068 2.304 4.248 2.304 4.884 C 2.304 5.4240003 2.892 5.64 3.6000001 5.64 C 4.3320003 5.64 4.716 5.388 5.1 5.004 C 5.28 4.824 5.484 4.788 5.6280003 4.788 C 5.952 4.788 6.1080003 5.0160003 6.1080003 5.268 C 6.1080003 5.376 6.072 5.52 5.964 5.7000003 C 5.544 6.372 4.644 6.7200003 3.6000001 6.7200003 C 2.316 6.7200003 1.224 6.216 1.224 4.872 C 1.224 3.432 2.5080001 3.108 3.6000001 2.88 C 4.14 2.784 5.16 2.5080001 5.16 1.8000001 C 5.16 1.068 4.14 0.96000004 3.6000001 0.96000004 C 2.832 0.96000004 2.424 1.284 1.908 1.728 C 1.728 1.8840001 1.608 1.944 1.428 1.944 C 1.2 1.944 0.972 1.836 0.972 1.488 C 0.972 1.26 1.056 1.0320001 1.212 0.852 C 1.848 0.120000005 2.652 -0.120000005 3.612 -0.120000005 Z"/></symbol><symbol id=g24953FDE2016845F3AA35B135497832F overflow=visible><path d="M 4.98 6.18 L 4.98 2.808 C 4.98 2.04 4.38 0.90000004 3.516 0.90000004 C 2.652 0.90000004 2.22 1.644 2.22 2.4720001 L 2.22 6.18 C 2.22 6.552 2.052 6.7200003 1.6800001 6.7200003 C 1.308 6.7200003 1.14 6.552 1.14 6.18 L 1.14 2.16 C 1.14 0.78000003 2.052 -0.120000005 3.336 -0.120000005 C 4.212 -0.120000005 4.752 0.36 4.98 1.128 L 4.98 0.42000002 C 4.98 0.048 5.1480002 -0.120000005 5.52 -0.120000005 C 5.892 -0.120000005 6.06 0.048 6.06 0.42000002 L 6.06 6.18 C 6.06 6.552 5.892 6.7200003 5.52 6.7200003 C 5.1480002 6.7200003 4.98 6.552 4.98 6.18 Z"/></symbol><symbol id=g9B0C0AD8F1AEB228C1E075A06DAB0CCF overflow=visible><path d="M 3.708 2.688 L 3.72 7.8 C 3.72 8.46 3.42 8.76 2.76 8.76 L 1.272 8.76 C 0.948 8.76 0.78000003 8.592 0.78000003 8.268 C 0.78000003 7.9440002 0.948 7.776 1.272 7.776 L 2.16 7.776 C 2.484 7.776 2.64 7.62 2.64 7.296 L 2.628 2.484 C 2.628 0.696 3.3960001 -0.120000005 4.548 -0.120000005 C 5.2200003 -0.120000005 5.772 -0.072 6.252 0.18 C 6.552 0.336 6.636 0.612 6.4440002 0.936 C 6.264 1.2360001 6.024 1.344 5.7000003 1.164 C 5.328 0.984 5.052 0.96000004 4.728 0.96000004 C 4.056 0.96000004 3.708 1.536 3.708 2.688 Z"/></symbol><symbol id=g7C1A9D5B9D088A582670715B1F160881 overflow=visible><path d="M 4.9440002 7.02 C 5.076 6.696 5.232 6.564 5.556 6.564 C 5.94 6.564 6.12 6.768 6.0360003 7.104 C 5.808 8.16 4.884 8.88 3.6000001 8.88 C 2.1 8.88 1.08 7.9440002 1.08 6.54 C 1.08 4.848 2.22 4.404 3.6000001 4.02 C 4.524 3.7680001 5.256 3.54 5.256 2.388 C 5.256 1.464 4.62 0.96000004 3.6000001 0.96000004 C 2.796 0.96000004 2.292 1.284 2.0640001 1.944 C 1.932 2.292 1.692 2.4 1.368 2.4 C 1.0320001 2.4 0.864 2.16 0.912 1.86 C 1.14 0.612 2.16 -0.120000005 3.6000001 -0.120000005 C 5.292 -0.120000005 6.336 0.852 6.336 2.388 C 6.336 4.272 5.136 4.716 3.6000001 5.136 C 2.796 5.364 2.16 5.568 2.16 6.564 C 2.16 7.248 2.7 7.8 3.6000001 7.8 C 4.212 7.8 4.716 7.596 4.9440002 7.02 Z"/></symbol><symbol id=gC7D2E548962E9978211011CB049CF7F5 overflow=visible><path d="M 1.86 -0.120000005 C 2.232 -0.120000005 2.4 0.048 2.4 0.42000002 L 2.4 4.2 C 2.4 5.196 3.408 5.64 4.236 5.64 C 5.1 5.64 5.28 5.076 5.28 4.344 L 5.28 4.2 C 5.28 3.828 5.448 3.66 5.82 3.66 C 6.192 3.66 6.36 3.828 6.36 4.2 L 6.36 4.344 C 6.36 5.6280003 6.048 6.7200003 4.608 6.7200003 C 3.684 6.7200003 2.652 6.2400002 2.4 5.472 L 2.4 6.18 C 2.4 6.552 2.232 6.7200003 1.86 6.7200003 C 1.488 6.7200003 1.32 6.552 1.32 6.18 L 1.32 0.42000002 C 1.32 0.048 1.488 -0.120000005 1.86 -0.120000005 Z"/></symbol><symbol id=gF66F70E570014D69E565237754049617 overflow=visible><path d="M 5.04 1.44 L 5.04 0 C 5.04 -1.38 4.224 -1.8000001 3.648 -1.8000001 C 2.976 -1.8000001 2.424 -1.404 2.076 -0.984 C 1.968 -0.84000003 1.848 -0.768 1.668 -0.768 C 1.404 -0.768 1.212 -0.984 1.14 -1.224 C 1.068 -1.488 1.092 -1.668 1.272 -1.872 C 1.716 -2.412 2.388 -2.88 3.504 -2.88 C 4.9440002 -2.88 6.12 -2.016 6.12 0 L 6.12 6.18 C 6.12 6.552 5.952 6.7200003 5.58 6.7200003 C 5.208 6.7200003 5.04 6.552 5.04 6.18 L 5.04 5.472 C 4.8120003 6.2400002 4.272 6.7200003 3.3960001 6.7200003 C 1.38 6.7200003 0.96000004 4.872 0.96000004 3.372 C 0.96000004 2.64 1.068 1.812 1.404 1.188 C 1.74 0.564 2.316 0.120000005 3.276 0.120000005 C 4.104 0.120000005 4.752 0.48000002 5.04 1.44 Z M 3.384 1.14 C 2.232 1.14 2.04 2.424 2.04 3.444 C 2.04 3.936 2.088 4.5 2.304 4.9440002 C 2.5080001 5.376 2.892 5.7000003 3.576 5.7000003 C 4.44 5.7000003 5.04 4.56 5.04 3.792 L 5.04 2.7120001 C 5.04 1.944 4.248 1.14 3.384 1.14 Z"/></symbol><symbol id=gA4AE1EFC2D46BA809ADD3F023DD67910 overflow=visible><path d="M 1.8000001 -2.676 C 4.104 -2.16 4.668 -1.008 4.668 0.276 C 4.668 1.008 4.392 1.86 3.5640001 1.86 C 2.892 1.86 2.52 1.44 2.52 0.804 C 2.52 0.288 2.844 -0.012 3.336 -0.108 C 3.684 -0.192 3.78 -0.312 3.696 -0.588 C 3.516 -1.128 2.736 -1.752 1.524 -2.052 C 1.344 -2.1 1.272 -2.316 1.3560001 -2.496 C 1.44 -2.688 1.608 -2.724 1.8000001 -2.676 Z"/></symbol><symbol id=g8F7C22B7CDAC394974B44C0CA68B68A8 overflow=visible><path d="M 2.28 5.124 L 2.28 7.2000003 C 2.28 7.524 2.436 7.6800003 2.76 7.6800003 L 5.748 7.6800003 C 6.072 7.6800003 6.2400002 7.896 6.2400002 8.22 C 6.2400002 8.544 6.072 8.76 5.748 8.76 L 2.16 8.76 C 1.5 8.76 1.2 8.46 1.2 7.8 L 1.2 0.96000004 C 1.2 0.3 1.5 0 2.16 0 L 5.748 0 C 6.072 0 6.2400002 0.216 6.2400002 0.54 C 6.2400002 0.864 6.072 1.08 5.748 1.08 L 2.76 1.08 C 2.436 1.08 2.28 1.2360001 2.28 1.5600001 L 2.28 4.044 L 5.34 4.044 C 5.664 4.044 5.88 4.26 5.88 4.584 C 5.88 4.908 5.664 5.124 5.34 5.124 Z"/></symbol></defs></svg></div><p><code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;?></code></code> 就表示前文的 <code class="font-semibold text-[#aa8bd5]"><code>Vec</code></code>, 需要向其中提供一个参数, 当你看到这, 类型构造器的概念其实也已经了解差不多了<br><hr class="border-2 border-dashed my-10"><h1 class="flex items-center w-fit my-6" id=lei-xing-gou-zao-qi><span class="text-2xl mr-2 text-cyan-500">🔗</span> <a class="text-4xl hover:underline underline-offset-8" href=#lei-xing-gou-zao-qi>类型构造器</a></h1><p>虽然前面已经讲了, 但这里还是写点具体的 rust 代码吧?<br><br>如下代码中的 <code class="font-semibold text-[#aa8bd5]"><code>Trait::Type</code></code> 便如同前文的 <code class="font-semibold text-[#aa8bd5]"><code>not</code></code> 函数, 不过 <code class="font-semibold text-[#aa8bd5]"><code>not</code></code> 是参数接收一个值, 并返回一个值, 其参数是 type 为 <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code> 的 value<br>而此时的 <code class="font-semibold text-[#aa8bd5]"><code>Trait::Type</code></code> 却是接收一个类型, 并返回一个新类型, 即参数是 kind 为 <code class="font-semibold text-[#aa8bd5]"><code>*</code></code> 的 type, 返回值是个新的 type<br>像这样接收 type, 以 type 作为参数并创建新的 type 的玩意儿, 我们将其称为 类型构造器<br><br>因此, <code class="font-semibold text-[#aa8bd5]"><code>Trait::Type</code></code> 的 kind 可以表示为 <code class="font-semibold text-[#aa8bd5]"><code>* -> *</code></code><br>(或者 <code class="font-semibold text-[#aa8bd5]"><code>type -> type</code></code>, 都表达了只在乎 kind, 就像是不管是 <code class="font-semibold text-[#aa8bd5]"><code>true</code></code> 还是 <code class="font-semibold text-[#aa8bd5]"><code>false</code></code>, 都可以用 <code class="font-semibold text-[#aa8bd5]"><code>bool</code></code> 来表示, 表达了只在乎 type)<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Trait {
    type Type&lt;T>;
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>我们可以通过将类型作为 <code class="font-semibold text-[#aa8bd5]"><code>Type&lt;T></code></code> 中的泛型参数 <code class="font-semibold text-[#aa8bd5]"><code>T</code></code> 传入, 然后在 <code class="font-semibold text-[#aa8bd5]"><code>impl</code></code> 块里面指定新的类型, 比如如下我们指定了类型构造器是 <code class="font-semibold text-[#aa8bd5]"><code>X -> Option&lt;X></code></code><br>在使用时, 我们只需要给类型构造器传入一个类型, 比如 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code> 后就能得到 <code class="font-semibold text-[#aa8bd5]"><code>Option&lt;i32></code></code> 了<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Trait {
    type Type&lt;T>;
}

impl Trait for () {
    type Type&lt;X> = Option&lt;X>;
}

fn main() {
    let a = &lt;() as Trait>::Type::&lt;i32>::default();  // Option::&lt;i32>::default()
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p><em>GATs</em> 其实就是让 <em>关联类型</em> 允许成为 <em>类型构造器</em><br>之前这玩意也被叫作 <em>ACT(Associated-Type-Constructors, 关联类型构造器)</em>, 差不多的意思, 无须在意<br><hr class="border-2 border-dashed my-10"><h1 class="flex items-center w-fit my-6" id=gao-jie-lei-xing-hkt><span class="text-2xl mr-2 text-cyan-500">🔗</span> <a class="text-4xl hover:underline underline-offset-8" href=#gao-jie-lei-xing-hkt>高阶类型(HKT)</a></h1><p>你可能听到过许多次 <em>高阶类型(Higher-Kinded-Type, HKT)</em> 的名字, 其实这与 <em>高阶函数(Higner-Ordered-Function, HOF)</em> 是一个道理:<br><br><ul class="list-disc ml-5"><li><em>高阶函数(HOF)</em>: 某种参数可以是 <em>函数与变量</em> 的 <em>函数</em><br><li><em>高阶类型(HKT)</em>: 某种参数可以是 <em>类型构造器与类型</em> 的 <em>类型构造器</em><br></ul><p><br>当然, 就像是 <em>HOF(高阶函数)</em> 不仅可以接收 <em>函数</em> 作为参数, 也可以如同 <em>普通的函数</em> 那样接收 <em>变量</em> 作为参数<br>HKT(高阶类型) 也一样, 不仅可以接收 类型构造器 作为参数, 也可以如同 普通的类型构造器 那样接收 类型 作为参数<br><br>继续类比进行理解, 对于 <em>高阶函数</em> 来讲, 什么 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>foreach</code></code> 之类的函数你肯定已经用过了, 这些函数都需要你手动传入闭包<br>换句话说, 这赋予了让用户选择怎么做的权利, 你传入 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code> 里面的闭包可以是让数组全部加 <code class="font-semibold text-[#aa8bd5]"><code>10</code></code>, 可以是全部变成 <code class="font-semibold text-[#aa8bd5]"><code>0</code></code><br><br><em>高阶类型(HKT)</em> 也是一样的道理, 比如我们在设计某个容器类型时:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">// 一个包装容器的类型
// 伪代码中的 `C[_]` 表示一个类型构造器
struct Container&lt;C[_] {
    data: C&lt;i32>
    // ...
    // ...
}

Container&lt;Vec>
Container&lt;LinkedList></code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>你可以用 <code class="font-semibold text-[#aa8bd5]"><code>Container&lt;Vec></code></code> 或者 <code class="font-semibold text-[#aa8bd5]"><code>Container&lt;LinkedList></code></code> 让用户决定该以何种形式去存储数据<br>但很可惜的是, 前文也说过 rust 中并不存在 HKT, 仅仅只有 <code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;i32></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>LinkedList&lt;i32></code></code> 这些具体类型, 只能通过 GATs 去模拟<br>HKT 就是类似这样的类型, 只是它提供了 <em>根据传入的类型构造器(或者类型), 构造某个新类型</em> 的能力<br><br>再多举一点类似的例子, 比如下面这段伪代码, 来自于 <a class="underline underline-offset-5 font-medium" href=https://docs.rs/lending-iterator/latest/lending_iterator/>lending_iterator</a> 中对 HKT 的说明:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">// ArrayKind 是一个类型构造器
struct Container&lt;ArrayKind[_]> {
    array_i32s: ArrayKind&lt;i32>,
    array_strings: ArrayKind&lt;String>,
}


type StructOfVecs = Container&lt;Vec>;
// Equals to
struct StructOfVecs {
    array_i32s: Vec&lt;i32>,
    array_strings: Vec&lt;String>,
}


type StructOfVecDeques = Container&lt;LinkedList>;
// Equals to
struct StructOfVecDeques {
    array_i32s: LinkedList&lt;i32>,
    array_strings: LinkedList&lt;String>,
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>我们甚至可以更加灵活一点, 通过临时构造一个类型, 来取代上面作为参数的 <code class="font-semibold text-[#aa8bd5]"><code>Vec</code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>LinkedList</code></code>:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">// 假设 `HKT!` 是一个魔法宏, 人为临时地构造了一个 `类型构造器`, 如同向 `map` 函数传入闭包一样
type StructOfPairs = StructOfArrays&lt; HKT!(T => [T; 2]) >;
// Equals to
struct StructOfPairs {
    array_i32s: [i32; 2],
    array_strings: [String; 2],
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>当然, rust 中并没有这种语法, 在 rust 中存在的是 <code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;i32></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>LinkedList&lt;i32></code></code> 这样的具体类型<br>但是, rust 中存在 GATs, 也就是上一节中介绍的那个 <em>泛型关联类型</em> 哩 :)<br><hr class="border-2 border-dashed my-10"><h1 class="flex items-center w-fit my-6" id=li-zi><span class="text-2xl mr-2 text-cyan-500">🔗</span> <a class="text-4xl hover:underline underline-offset-8" href=#li-zi>例子</a></h1><p>来点小例子吧, 随便瞎扯一些, 想到了啥就扯点啥<br><h2 class="flex items-center w-fit my-6" id=rong-qi-lei-xing><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#rong-qi-lei-xing>容器类型</a></h2><p>我将如何抽象某个容器类型放到第一个地方讲, 因为这部分比较经典与有趣 <span style="display: inline-block;"><del>(其实是因为比较简单啦, 太难直接把读者劝退了咋办)</del></span><br>得益于 rust 中 GATs 的存在, 我们可以如上面的伪代码中那样抽象容器类型:<br><br>在 <code class="font-semibold text-[#aa8bd5]"><code>iterate</code></code> 方法中, 我们返回了集合迭代时的具体类型, 但因为不同集合类型的迭代器具体类型是不一样的, 所以我们需要进行抽象:<br><br><ul class="list-disc ml-5"><li><code class="font-semibold text-[#aa8bd5]"><code>Vec&lt;T></code></code> 对应的迭代器具体类型 <code class="font-semibold text-[#aa8bd5]"><code>std::slice::Iter&lt;'a, T></code></code><li><code class="font-semibold text-[#aa8bd5]"><code>LinkedList&lt;T></code></code> 对应的迭代器具体类型是 <code class="font-semibold text-[#aa8bd5]"><code>std::collections::linked_list::Iter&lt;'a, T></code></code></ul><p><br>因此我们可以通过 GATs 来表述, 无非就是多了个生命周期 (生命周期也是泛型的一种), 然后为各种集合类型实现该 trait:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">// Vec
impl&lt;T> Collection&lt;T> for Vec&lt;T> {
    type Iter&lt;'iter> = std::slice::Iter&lt;'iter, T> 
    where
        T: 'iter;

    fn empty() -> Self {
        vec![]
    }

    fn add(&mut self, value: T) {
        self.push(value);
    }

    fn iterate(&self) -> Self::Iter&lt;'_> {
        self.iter()
    }
}

// LinkedList
impl&lt;T> Collection&lt;T> for LinkedList&lt;T> {
    type Iter&lt;'iter> = std::collections::linked_list::Iter&lt;'iter, T>
    where
        T: 'iter;

    fn empty() -> Self {
        LinkedList::new()
    }

    fn add(&mut self, value: T) {
        self.push_back(value);
    }

    fn iterate(&self) -> Self::Iter&lt;'_> {
        self.iter()
    }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>以 trait 为基调的实现比较符合 rust 常见的编码风格<br>你可以把你脑子里那些什么 <em>HKT</em>, <em>GATs</em> 等名词, <em>类型构造器</em>, <em>kind</em>, <em>type</em> 等概念全删掉, 然后仅简单将上述代码看作关联类型<br>(这也是语言特性的开发团队为了一致性与兼容性所深思熟虑过的事情捏)<br><br>然后我们可以拥有像这样的方法, 比如让元素是整数类型的集合转换为浮点数的集合:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">fn floatify&lt;Input, Output>(ints: &Input) -> Output
where 
    Input: Collection&lt;i32>,
    Output: Collection&lt;f32>
{
    let mut floats = Output::empty();
    for &i in ints.iterate() {
        floats.add(i as f32);
    }
    floats
}

fn main() {
    let v = vec![1, 2, 3];
    let v: Vec&lt;_> = floatify(&v);

    let l = LinkedList::from_iter([4, 5, 6]);
    let l: LinkedList&lt;_> = floatify(&l);
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>同时需要注意类型推断, 这让迭代器被 <code class="font-semibold text-[#aa8bd5]"><code>collect</code></code> 成某个具体的集合类型时同理, 毕竟有许多实现了 <code class="font-semibold text-[#aa8bd5]"><code>Collection&lt;f32></code></code>, 编译器怎么知道是哪个呢?<br>我们希望不会改变集合的类型, 仅改变集合元素的类型, 但当故意手动添加不同集合的类型作为注解时, 能导致集合的类型改变:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">let l = LinkedList::from_iter([4, 5, 6]);
let l: Vec&lt;_> = floatify(&l);</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>这是因为 rust 通过我们提供的类型推导出了 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code> 类型, 而 <code class="font-semibold text-[#aa8bd5]"><code>Input</code></code> 的类型则是根据我们传入的参数, 已经固定推导出来了<br>有没有什么办法从类型的关系上, 让 rust 不必通过用户提供的类型进行推导, 而是直接从参数进行推导, 从而限制住用户这种太过自由的行为呢?<br><br>当然! 这里可以让编译器自动推导出 <code class="font-semibold text-[#aa8bd5]"><code>Input</code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code> 是相同的集合类型(除了元素的类型不同) 这一我们想要的事实<br>其实就是加个关联类型成员, 再将其添加一个 trait-bound 即可:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Collection&lt;T> {
    type Output&lt;M>: Collection&lt;M>;
    // ...
}

impl&lt;T> Collection&lt;T> for Vec&lt;T> {
    type Output&lt;M> = Vec&lt;M>;
    // ...
}

fn floatify&lt;Input>(ints: &Input) -> Input::Output&lt;f32>
where 
    Input: Collection&lt;i32>,
{
    let mut floats = Input::Output::&lt;f32>::empty();
    // ...
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>我们不想使用用户提供的类型注解, 所以直接用跟参数一起的关联类型, 避免了集合的类型能从 <code class="font-semibold text-[#aa8bd5]"><code>Vec</code></code> 变成 <code class="font-semibold text-[#aa8bd5]"><code>LinkedList</code></code><br>值得注意的是, 有时候我们想要的是将选择的权力交给调用方, 也就是用户, 在下文中的 family-trait 部分中会提到<br><h2 class="flex items-center w-fit my-6" id=functor><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#functor>Functor</a></h2><p>(倘若你已经理解了先前的知识点, 这里理解起来应该也不算太难)<br><br>相信大家肯定用过 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code> 函数吧, 不管是 <code class="font-semibold text-[#aa8bd5]"><code>std::iter::Iterator</code></code> 这个 trait 里面的 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code>, 还是为 <code class="font-semibold text-[#aa8bd5]"><code>array</code></code> 类型单独实现的 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code>, 反正你肯定用过就对了<br>那么你有没有想过, 为什么 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code> 函数的实现就得分离开来呢? 能否有个统一的 trait, 比如 <code class="font-semibold text-[#aa8bd5]"><code>Mapable</code></code>, 能够抽象这样的行为, 统一规范所有的实现呢?<br><br>在各种各样以函数式编程为主的语言中, 就存在着这样一个概念, 不过它不叫 <code class="font-semibold text-[#aa8bd5]"><code>Mapable</code></code>, 而叫 <code class="font-semibold text-[#aa8bd5]"><code>Functor</code></code><br>让我们尝试利用 rust 中的 GATs 来实现这样一个抽象了 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code> 行为的 trait:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Functor {
    type Inner;      // Unwrapped/Unplugged (代表容器内部值的类型)
    type Output&lt;T>;  // Wrapper/Plugged (代表容器本身的类型, 其实是个接收类型创建新类型的类型构造器)

    // 为了与原本的 `map` 区分开来, 我们将方法取名为 `fmap`  
    fn fmap&lt;F, B>(self, f: F) -> Self::Output&lt;B>
    where
        F: FnMut(Self::Inner) -> B;
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>倘若你把 <code class="font-semibold text-[#aa8bd5]"><code>Output&lt;T></code></code> 改成 <code class="font-semibold text-[#aa8bd5]"><code>Output</code></code>, 意图根据此来指代整个容器类型的概念…你可以自己试一试, 无法编译通过<br>以 <code class="font-semibold text-[#aa8bd5]"><code>Option</code></code> 类型为例 (<code class="font-semibold text-[#aa8bd5]"><code>Result</code></code> 类型同理):<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">impl&lt;T> Functor for Option&lt;T> {
    type Inner = T;
    type Output&lt;U> = Option&lt;U>;

    fn fmap&lt;F, U>(self, mut f: F) -> Self::Output&lt;U>
    where
        F: FnMut(Self::Inner) -> U,
    {
        #[allow(clippy::manual_map)]
        match self {
            None => None,
            Some(t) => Some(f(t)),
        }

        // // 你也可以直接复用标准库中已经实现的 `map`  
        // self.map(f)
    }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>照猫画虎为 <code class="font-semibold text-[#aa8bd5]"><code>array</code></code> 类型实现一下:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">impl&lt;T, const N: usize> Functor for [T; N] {
    type Inner = T;
    type Output&lt;U> = [U; N];
    fn fmap&lt;F, B>(self, f: F) -> Self::Output&lt;B>
    where
        F: FnMut(Self::Inner) -> B,
    {
        self.map(f)
    }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>倘若没有 GATs, 也就是没有 <code class="font-semibold text-[#aa8bd5]"><code>type Output&lt;T></code></code> 这里的类型构造器的情况下, 我们将只可能拥有同态的 functor<br>也就是说 <code class="font-semibold text-[#aa8bd5]"><code>map</code></code> 函数必须返回相同的类型, 即只能 <code class="font-semibold text-[#aa8bd5]"><code>T -> T</code></code>, 而无法 <code class="font-semibold text-[#aa8bd5]"><code>T -> U</code></code>, 我们此刻的是多态的 functor, 对应后者<br><br>还有其他非常多的来自函数式编程中的一些概念, 不过 Functor 算是其中最经典最简单的一个了<br>其余在 rust 中的实现, 就请自行查阅与思考吧!<br><br><span style="display: inline-block;"><del>(我是不会告诉你其实是因为有些概念我也看不懂所以才不继续讲的)</del></span><br><h2 class="flex items-center w-fit my-6" id=selffan-xing><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#selffan-xing>Self泛型</a></h2><p>众所周知, rust 中的 <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code> 是一个类型别名, 指示你正在 impl 的那个类型, 如 <code class="font-semibold text-[#aa8bd5]"><code>impl i32 { ... }</code></code> 时, <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code> 就指代 <code class="font-semibold text-[#aa8bd5]"><code>i32</code></code><br>同样众所周知的一点, 那就是 <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code> 是不能够添加泛型的, 你只能 <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code>, 而不能 <code class="font-semibold text-[#aa8bd5]"><code>Self&lt;T></code></code><br><br>让 <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code> 能够泛型化有什么用呢? 让我们以之前的 <code class="font-semibold text-[#aa8bd5]"><code>Functor</code></code> 为例, 倘若其可以支持泛型:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait Functor&lt;T>: HKT1 {
    fn map&lt;U, F>(self, f: F) -> Self::With&lt;U>
    where
        F: FnMut(T) -> U;
}

impl&lt;T> Functor&lt;T> for Option&lt;T> {
    fn map&lt;U, F>(self, f: F) -> Self&lt;U> 
    where
        F: FnMut(T) -> U
    {
        self.map(f)
    }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>倘若用模式匹配的思想看待上述伪代码, 你会发现返回值的类型 <code class="font-semibold text-[#aa8bd5]"><code>Self&lt;U></code></code> 对应 <code class="font-semibold text-[#aa8bd5]"><code>Option&lt;U></code></code>, 则 <code class="font-semibold text-[#aa8bd5]"><code>Self</code></code> 就自然对应了 <code class="font-semibold text-[#aa8bd5]"><code>Option</code></code><br>这在今天的 rust 中可能吗? 不, 这不可能, rust 中的类型都是具体类型, 比如 <code class="font-semibold text-[#aa8bd5]"><code>M&lt;T, U, Z></code></code>, 而不可能是 <code class="font-semibold text-[#aa8bd5]"><code>M</code></code> 这种没写全的<br><br>哭唧唧, 要是能够像这样写岂不是会写得很爽? (虽然本质上一样, 无非是先前那套 Functor 的关联类型给你隐藏起来了而已)<br>但鉴于 GATs 的存在, 我们确实可以模拟出来:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait HKT1 {
    type Inner1;
    type With&lt;T>;
}

impl&lt;T> HKT1 for Option&lt;T> {
    type Inner1 = T;
    type With&lt;A> = Option&lt;A>;
}

impl&lt;T> Functor&lt;T> for Option&lt;T> {
    fn map&lt;U, F>(self, f: F) -> Self::With&lt;U>
    where
        F: FnMut(T) -> U,
    {
        self.map(f)
    }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>本质上和先前的 <code class="font-semibold text-[#aa8bd5]"><code>Functor</code></code> 是一样的, 只是我们包装起来稍微舒服点, 通过 <code class="font-semibold text-[#aa8bd5]"><code>Self::With&lt;U></code></code> 来模拟 <code class="font-semibold text-[#aa8bd5]"><code>Self&lt;U></code></code> 了<br>你也可以模仿上面的 <code class="font-semibold text-[#aa8bd5]"><code>HKT1</code></code>, 定义 <code class="font-semibold text-[#aa8bd5]"><code>HKT2</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>HKT3</code></code> 等 trait, 并且实现:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait HKT2 {
    type Inner1;
    type Inner2;
    type With&lt;T, U>;
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>如果使用宏的话, 这些重复的定义都能够自动生成, 且自动为你指定的类型实现, 不过我懒得继续讲宏了, 就这样吧, 略过略过!!<br>(你可以把宏理解为操控字符串, 只要你懂得怎么自动生成这些代码, 就可以通过声明宏喂给编译器进行解析)<br><h2 class="flex items-center w-fit my-6" id=family-trait><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#family-trait>family-trait</a></h2><p><code class="font-semibold text-[#aa8bd5]"><code>family-trait</code></code>/<code class="font-semibold text-[#aa8bd5]"><code>type-family</code></code> 是种技巧, 也可以说是设计模式, 你能暴露出部分内部的实现, 然后让用户自行选择使用哪部分<br><br>其实理解起来很简单, 让我们看看下面几个类型:<br><br><ul class="list-disc ml-5"><li><code class="font-semibold text-[#aa8bd5]"><code>Rc&lt;RefCell&lt;T>></code></code><li><code class="font-semibold text-[#aa8bd5]"><code>Rc&lt;Cell&lt;T>></code></code><li><code class="font-semibold text-[#aa8bd5]"><code>Arc&lt;Mutex&lt;T>></code></code><li><code class="font-semibold text-[#aa8bd5]"><code>Arc&lt;RwLock&lt;T>></code></code></ul><p><br>这些都是 <em>智能指针(smart-pointer)</em>, 且提供了内部可变性, 但是分为了单/多线程的情况<br><br>让我们再具体一点, 并且将问题只放在 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>Arc</code></code> 上, 倘若你正在编写树状的数据结构, 用 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code> 或 <code class="font-semibold text-[#aa8bd5]"><code>Arc</code></code> 来包裹树的结点<br>如果你只用了 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code> 作为结点的类型, 那么你的用户就会开始吵闹: "喂, 为什么用的不是 <code class="font-semibold text-[#aa8bd5]"><code>Arc</code></code> 啊? 你让我多线程情况下怎么用啊?"<br>如果你只用了 <code class="font-semibold text-[#aa8bd5]"><code>Arc</code></code> 作为结点的类型, 那么你的用户就会开始吵闹: "喂, 为什么用的不是 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code> 啊? 单线程情况下速度也太慢了吧?"<br><br>你汗流浃背, 为了满足两大需求不同的群体, 你选择…写两份代码! 粘贴, 复制, 将 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code> 替换为 <code class="font-semibold text-[#aa8bd5]"><code>Arc</code></code>, 一气呵成<br>(但面对天灾(指暴怒且嗷嗷待哺的用户们), 我们并非无计可施)<br><br>(其实写两份代码也是非常简单的正确方法捏, 比如 <code class="font-semibold text-[#aa8bd5]"><code>im-rc</code></code> 与 <code class="font-semibold text-[#aa8bd5]"><code>im</code></code> 这两个 crate 就是这种情况)<br><br>倘若我们可以定义一个 reference-counted(引用计数) 的 family<br>但通过 GATs, 我们就可以先内部进行抽象, 然后再暴露出去让用户自己选择到底是 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code> 还是 <code class="font-semibold text-[#aa8bd5]"><code>Arc</code></code> 了:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">trait RefCountedFamily {
    type Pointer&lt;T>;
    fn new&lt;T>(value: T) -> Self::Pointer&lt;T>;
    // ...
    // ...
}

struct RcFamily;
impl RefCountedFamily for RcFamily {
    type Pointer&lt;T> = Rc&lt;T>;
    fn new&lt;T>(value: T) -> Self::Pointer&lt;T> {
        Rc::new(value)
    }
    // ...
    // ...
}

struct ArcFamily;
impl RefCountedFamily for ArcFamily {
    type Pointer&lt;T> = Arc&lt;T>;
    fn new&lt;T>(value: T) -> Self::Pointer&lt;T> {
        Arc::new(value)
    }
    // ...
    // ...
}

struct Container&lt;P: RefCountedFamily> {
    data: P::Pointer&lt;i32>,
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>用户使用的时候可以通过传入诸如 <code class="font-semibold text-[#aa8bd5]"><code>RcFamily</code></code> 这种实现了 family-trait 的具体类型, 以此选择了使用 <code class="font-semibold text-[#aa8bd5]"><code>Rc</code></code>:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">let c = Container::&lt;RcFamily> {
    data: RcFamily::new(1),
};</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>对于最开始的 <code class="font-semibold text-[#aa8bd5]"><code>Rc&lt;RefCell&lt;T>></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Rc&lt;Cell&lt;T>></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Arc&lt;Mutex&lt;T>></code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Arc&lt;RwLock&lt;T>></code></code> 也是同理<br>你可以组合这些类型, 暴露出来, 然后交给用户进行选择, 抽象了 线程安全/智能指针 的选择<br><h2 class="flex items-center w-fit my-6" id=jie-dai-die-dai><span class="text-2xl m-2 text-cyan-500">> </span> <a class="text-2xl hover:underline underline-offset-8" href=#jie-dai-die-dai>借贷迭代</a></h2><p>(以下部分代码来自 <a class="underline underline-offset-5 font-medium" href=https://rust-lang.github.io/generic-associated-types-initiative/explainer/motivation.html>https://rust-lang.github.io/generic-associated-types-initiative/explainer/motivation.html</a>)<br><br><code class="font-semibold text-[#aa8bd5]"><code>streaming-iterator</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>lending-iterator</code></code>, 这两个都是同一个东西, 请注意, 这和 <em>async(异步)</em> 生态中的 <code class="font-semibold text-[#aa8bd5]"><code>Stream</code></code> 不是一个概念<br>因为前者的名字可能会与 async 生态中的 <code class="font-semibold text-[#aa8bd5]"><code>Stream</code></code> 一起造成困扰, 所以我个人更偏向于使用后者的名词<br><br><em>lending-iterator(借贷迭代器)</em>, 概念上来讲就是 GATs 版的 <code class="font-semibold text-[#aa8bd5]"><code>std::iter::Iterator</code></code>, 并且关联类型的泛型参数是个 lifetime<br><br>先让我们重温下 <code class="font-semibold text-[#aa8bd5]"><code>std::iter::Iterator</code></code> 相关的内容:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">pub trait Iterator {
    type Item;
    fn next(&mut self) -> Option&lt;Self::Item>;
    // ...
    // ...
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>里面有一个非泛型的关联类型 <code class="font-semibold text-[#aa8bd5]"><code>Item</code></code>, 我们可以调用 <code class="font-semibold text-[#aa8bd5]"><code>next</code></code> 方法进行迭代, 因此我们可以写出类似这样的代码:<br><pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = '好啦';
            setTimeout(() => button.textContent = '复制', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == '折叠') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = '展开'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = '折叠'
          }
        }</script><p><code class="language-rust text-sm sm:text-base">struct Iter&lt;'a, T> {
    data: &'a [T],
}

impl&lt;'a, T> Iterator for Iter&lt;'a, T> {
    type Item = &'a T;

    fn next(&mut self) -> Option&lt;Self::Item> {
        self.data.split_first().map(|(prefix_elem, suffix)| {
            self.data = suffix;
            prefix_elem
        })
    }
}

fn main() {
    let mut iter = Iter { data: &[1, 2, 3] };
    assert_eq!(iter.next(), Some(&1));
    assert_eq!(iter.next(), Some(&2));
    assert_eq!(iter.next(), Some(&3));
    assert_eq!(iter.next(), None);
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick=copy_code(this)>复制</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick=fold_code(this)>折叠</button></pre><p>在这里, <code class="font-semibold text-[#aa8bd5]"><code>Item</code></code> 的类型被指定为 <code class="font-semibold text-[#aa8bd5]"><code>&'a T</code></code>, sd<br><p>(写累了, 鸽了, 什么时候想起来了再继续吧)<br><hr class="border-2 border-dashed my-10"><div class="flex flex-col sm:mx-2 *:my-2"><a class="flex items-center border-2 border-slate-500 w-full sm:rounded-md hover:border-white justify-start" hx-swap="innerHTML show:window:top" href=/posts/rust-typed-magic/curried-function hx-get=/posts/rust-typed-magic/curried-function/index.html hx-push-url=/posts/rust-typed-magic/curried-function hx-target=body><span class="text-2xl sm:text-4xl sm:p-2 pl-2 pr-1 order-first">&lt;</span> <span class="text-xl sm:text-2xl sm:p-2">柯里化柯里化与过程过程宏</span></a><a class="flex items-center border-2 border-slate-500 w-full sm:rounded-md hover:border-white justify-end" hx-swap="innerHTML show:window:top" href=/posts/rust-typed-magic/heterogeneous-list hx-get=/posts/rust-typed-magic/heterogeneous-list/index.html hx-push-url=/posts/rust-typed-magic/heterogeneous-list hx-target=body><span class="text-2xl sm:text-4xl sm:p-2 pr-2 pl-1 order-last">></span> <span class="text-xl sm:text-2xl sm:p-2">异构列表</span></a></div></div>