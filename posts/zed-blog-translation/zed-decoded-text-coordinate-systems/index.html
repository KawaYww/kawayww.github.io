<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æŸ³ä¸Šå·</title><meta name="description" content="æŸ³ä¸Šå·çš„åšå®¢"/><link rel="shortcut icon" href="/images/blog/avatar.avif" type="image/avif"/><link rel="stylesheet" href="/styles/highlight.min.css"/><link rel="stylesheet" href="/fonts/MapleMono-NF-CN-Regular/result.css"/><link rel="stylesheet" href="/fonts/MapleMono-NF-CN-Italic/result.css"/><link rel="stylesheet" href="/fonts/MapleMono-NF-CN-Bold/result.css"/><link rel="stylesheet" href="/styles/catppuccin-macchiato.css"/><link rel="stylesheet" href="/iconfonts/iconfont.css"/><link rel="stylesheet" href="/styles/tailwind.css"/><script src="/scripts/highlight.min.js"> </script><script src="/scripts/rust.min.js"> </script><script src="/scripts/nix.min.js"> </script><script src="/scripts/scheme.min.js"> </script><script src="/scripts/htmx.min.js"> </script><script src="/scripts/prefetch.js"> </script><script src="/scripts/custom.js"> </script><meta name="darkreader-lock"></head>
  <body>
    <div id="content" class="flex flex-col mx-4 mb-20 scroll-smooth" lang="zh-Hans">
      <div class="text-2xl sm:text-3xl my-4 w-full text-center">ã€æ–‡æœ¬åæ ‡ç³»ã€</div>
      <div class="font-medium w-fit sm:mx-auto flex flex-col border-l-4 pl-2 sm:flex-row sm:border-l-0 sm:pl-0">
        <p>[å†™è‡ª:2025-08-06</p>
        <div class="px-2 hidden sm:inline">â”‚</div>
        <p>ä½œè€…:æŸ³ä¸Šå·</p>
        <div class="px-2 hidden sm:inline">â”‚</div>
        <p>ç³»åˆ—:<a class="underline underline-offset-5" href="/categories/zed-blog-translation" hx-get="/categories/zed-blog-translation/index.html" hx-target="body" hx-push-url="/categories/zed-blog-translation" hx-swap="innerHTML show:window:top">zed-blog-translation</a>]</p>
      </div>
      <div class="flex flex-col items-center m-4">
        <div class="w-fit mx-auto text-lg font-semibold">æ‘˜è¦</div>
        <div class="w-fit break-keep text-center sm:mx-[25%] *:inline">å¯¹åšå®¢ <a class="underline underline-offset-5 font-medium" href="https://zed.dev/blog/zed-decoded-text-coordinate-systems">Text Coordinate Systems</a> çš„ç¿»è¯‘</div>
      </div>
      <div class="flex flex-col my-10 w-fit border-2 border-slate-500">
        <p><span class="text-2xl">ç›®å½•:</span></p>
        <div class="w-fit pr-2 my-2">
          <div class="leading-5"><span class="pl-2"><span class="font-bold text-sm">â”Œâ”€â–º</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href="#point">Point</a></span></div>
          <div class="leading-5"><span class="pl-2"><span class="font-bold text-sm">â”œâ”€â–º</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href="#offset">Offset</a></span></div>
          <div class="leading-5"><span class="pl-2"><span class="font-bold text-sm">â”œâ”€â–º</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href="#utf-16,-ng">UTF-16, å—¯?</a></span></div>
          <div class="leading-5"><span class="pl-2"><span class="font-bold text-sm">â”œâ”€â–º</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href="#displaypoint">DisplayPoint</a></span></div>
          <div class="leading-5"><span class="pl-2"><span class="font-bold text-sm">â””â”€â–º</span><a class="text-sm hover:text-sky-500 hover:font-semibold hover:underline underline-offset-5" href="#anchor">Anchor</a></span></div>
        </div>
      </div>
      <p>å½“æœ‰äººè¯¢é—®ä½ : â€œä½ çš„å…‰æ ‡åœ¨å“ª?â€ ç­”æ¡ˆå¯èƒ½ç±»ä¼¼ â€œç¬¬ 18 è¡Œâ€<br>å½“ç„¶, å¦‚æœä½ é‚£å¤©ç›´è§‰æƒŠäºº, ä¹Ÿå¯ä»¥ç±»ä¼¼ â€œç¬¬ 18 è¡Œ, ç¬¬ 5 åˆ—â€, è¡Œä¸åˆ—, å°±æ˜¯è¿™ä¹ˆç®€å•è½»æ¾<br><br>åŒ…æ‹¬ Zed åœ¨å†…çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¹Ÿä½¿ç”¨ <code class="font-semibold text-[#aa8bd5]"><code>lines</code></code> ä¸ <code class="font-semibold text-[#aa8bd5]"><code>columns</code></code> çš„æ¦‚å¿µå»æè¿°ä½ç½®<br>ä½†å½“æˆ‘ç¬¬ä¸€æ¬¡æ¢ç´¢å…¶æºç æ—¶, å‘ç°å…¶ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»– â€œåæ ‡ç³»â€: <code class="font-semibold text-[#aa8bd5]"><code>offsets(åç§»é‡)</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>offset in UTF-16</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>display points</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>anchors</code></code><br><br>ä¸ºäº†æœ€ç»ˆäº†è§£è¿™äº›ä¸åŒçš„æ–‡æœ¬åæ ‡ç³», ä»¥åŠä½•æ—¶è¯¥ä½¿ç”¨å“ªä¸ªåæ ‡ç³», æˆ‘ä¸ Zed çš„ä¸¤ä½è”åˆåˆ›å§‹äºº Nathan, Antonio å±•å¼€äº†äº¤è°ˆ<br>ä»–ä»¬å¼•å¯¼æˆ‘å®Œæˆäº†ä» <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> -> <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> -> <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> çš„å…¨éƒ¨è¿‡ç¨‹<br>(è¯‘è€…æ³¨: youtube ä¸Šçš„é…å¥—è§†é¢‘: <a class="underline underline-offset-5 font-medium" href="https://youtu.be/il7NoDUFCWU">ä¼ é€é—¨</a>)<br></p>
      <hr class="border-2 border-dashed my-10">
      <h1 class="flex items-center w-fit my-6" id="point"><span class="text-2xl mr-2 text-cyan-500">ğŸ”—</span> <a class="text-4xl hover:underline underline-offset-8" href="#point">Point</a></h1>
      <p>é¦–å…ˆ, æˆ‘ä»¬æ¥è°ˆè°ˆ Zed ä¸­æœ€æ˜æ˜¾çš„æ–‡æœ¬åæ ‡å½¢å¼: <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code><br>ä¸€ä¸ª <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> ä»£è¡¨ç€æ–‡æœ¬ç¼“å†²åŒºä¸­ â€œä»¥ 0 ä¸ºåˆå§‹ç´¢å¼•â€ ä¸” â€œç”±è¡Œä¸åˆ—ç»„æˆâ€ çš„ç‚¹<br>å®ƒçœ‹èµ·æ¥ç±»ä¼¼è¿™æ ·:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">// crates/rope/src/point.rs
 
struct Point {
    row: u32,
    column: u32,
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>è¿™å¹¶ä¸å¥‡æ€ª, Row &amp; Column, å°±åƒè‚‰ä¸åœŸè±†ä¸€æ ·è‡ªç„¶<br>ä»¥ä¸‹æ˜¯æˆ‘ä»¬å…¶ä¸­ä¸€é¡¹æµ‹è¯•çš„ä»£ç ç‰‡æ®µ, ç”¨äºè¯´æ˜å¦‚ä½•ä½¿ç”¨ <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code>:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">let last_selection_start = editor.selections.last::&lt;Point>(cx).range().start;
assert_eq!(last_selection_start, Point::new(2, 0));</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>æ­¤å¤„çš„ <code class="font-semibold text-[#aa8bd5]"><code>assertion</code></code> è¯•å›¾ç¡®ä¿é€‰åŒºä»ç¬¬ä¸‰è¡Œ(ç´¢å¼•ä» 0 å¼€å§‹!), ç¬¬ä¸€åˆ—å¼€å§‹<br><code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> çš„ä¾¿åˆ©ä¹‹å¤„åœ¨äº, å®ƒèƒ½è½»æ¾è¡¨è¾¾æ²¿çº¿æ¡çš„å®šä½æ“ä½œ, æ¯”å¦‚ â€œå°†å…‰æ ‡ä¸‹ç§»ä¸€è¡Œâ€ åªéœ€ç®€å•å¢åŠ  <code class="font-semibold text-[#aa8bd5]"><code>row</code></code> å³å¯:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">let old_point = Point::new(18, 5);
let new_point = Point::new(point.row + 1, point.column);</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>ä» line-18 å˜åˆ° line-19, æˆ‘ä»¬ä»…éœ€ç®€å•åŠ ä¸€, å¦‚æœæƒ³å›å», é‚£å°±è®¾ä¸ºè´Ÿä¸€<br>ä½†æ˜¯, å¦‚æœæ‚¨æƒ³å‘å·¦æˆ–è€…å‘å³ç§»åŠ¨æ—¶è¯¥æ€ä¹ˆåŠå‘¢?<br><br>è¿™å°†æ£˜æ‰‹èµ·æ¥, å› ä¸ºä¸åŒè¡Œå¯èƒ½æœ‰ä¸åŒé•¿åº¦, ç®€å•çš„åŠ å‡æ³•å¯èƒ½ä¼šå¯¼è‡´æ‚¨åœ¨æ–‡æœ¬ä¸­çš„ä½ç½®å˜å¾—æ— æ•ˆ<br>äº‹å®è¯æ˜, <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> çœ‹èµ·æ¥ç®€å•, ä½†å®é™…ä¸Šå…·æœ‰æ¬ºéª—æ€§, æˆ‘ä»¬ä»éœ€è¦å°å¿ƒå¤„ç†å®ƒ<br><br>ä»¥ Zed ä¸ºä¾‹, <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> éµå¾ª Nathan æ‰€è¯´çš„ â€œtypewriter logicâ€(æ‰“å­—æœºé€»è¾‘): å›è½¦ç¬¦(æœ¬è´¨ä¸Šæ–°å¢ä¸€è¡Œ)ä¼šå°† <code class="font-semibold text-[#aa8bd5]"><code>column</code></code> çš„è®°æ•°é‡ç½®ä¸º 0<br>æ¯•ç«Ÿåœ¨æ‰“å­—æœºä¸Š, å›è½¦åçš„å°å­—å¤´ä¼šå›åˆ°ä¸‹ä¸€è¡Œçš„èµ·å§‹ä½ç½®<br><br>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹, è¿™é‡Œæœ‰ä¸€ä¸ªåœ¨ Zed ä»£ç åº“ä¸­é€šè¿‡çš„æµ‹è¯•, æ³¨æ„å…¶ä¸­çš„ <code class="font-semibold text-[#aa8bd5]"><code>column</code></code>:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">fn test_point_basics() {
    let point_a = Point::new(5, 8);
    let point_b = Point::new(2, 10);
    let result = point_a + point_b;
 
    assert_eq!(result, Point::new(7, 10));
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>è¿™é‡Œçš„ä¸¤ä¸ª point è¢«åŠ åœ¨ä¸€èµ·, 5 å’Œ 2 å¾—åˆ°äº† 10, ä½†åˆ—å´ä»ç„¶æ˜¯ 10, å³ <code class="font-semibold text-[#aa8bd5]"><code>point_b</code></code> çš„åˆ—å€¼<br>çœ‹æ¥ç”¨ point è¿›è¡Œæ–‡æœ¬æ•°å­¦çš„è¿ç®—å¹¶ä¸åƒæˆ‘æƒ³çš„é‚£ä¹ˆç®€å•ç›´æ¥å‘¢?<br></p>
      <hr class="border-2 border-dashed my-10">
      <h1 class="flex items-center w-fit my-6" id="offset"><span class="text-2xl mr-2 text-cyan-500">ğŸ”—</span> <a class="text-4xl hover:underline underline-offset-8" href="#offset">Offset</a></h1>
      <p><code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code>(åç§»é‡) æ˜¯ Zed ä¸­çš„å¦ä¸€ç§æ–‡æœ¬åæ ‡ç³»ç»Ÿ, å…¶æ¦‚å¿µç®€æ˜ç›´æ¥<br>è¿™æ˜¯ä¸ªæ•°å­—, ç”¨äºè¡¨ç¤º â€œæ–‡æ¡£ä¸­çš„æŸä¸ªä½ç½®â€ è·ç¦» â€œæ–‡æ¡£èµ·å§‹ä½ç½®â€ çš„ Byte(å­—èŠ‚) æ•°<br><br>æ–‡æ¡£çš„å¼€å¤´è‡ªç„¶å°±æ˜¯ <code class="font-semibold text-[#aa8bd5]"><code>Offset::new(0)</code></code>, ä½äº <code class="font-semibold text-[#aa8bd5]"><code>Hello World</code></code> ä¸­çš„ <code class="font-semibold text-[#aa8bd5]"><code>W</code></code> çš„ä½ç½®æ˜¯ <code class="font-semibold text-[#aa8bd5]"><code>Offset::new(6)</code></code><br>æ–‡æ¡£ä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦åˆ™æ˜¯ <code class="font-semibold text-[#aa8bd5]"><code>Offset::new(document.len() - 1)</code></code><br>(å‡è®¾æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚)<br><br><code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code> åœ¨å¤„ç†è·¨è¶Šå¤šè¡Œçš„æ–‡æœ¬æ—¶ç‰¹åˆ«æœ‰ç”¨:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">let start = Offset::new(10);
let end = Offset::new(50);
let selection = Selection::new(start, end);</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>å®Œå…¨ä¸éœ€è¦æ‹…å¿ƒåˆ—, ä»è¿™ä¸ªå­—ç¬¦åˆ°é‚£ä¸ªå­—ç¬¦, åŒ…æ‹¬æ¢è¡Œç¬¦, è¿™äº›å¾ˆå®¹æ˜“ç”¨ <code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code> æ¥è¡¨è¾¾<br>ä½†åŒæ ·, <code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code> ä¹Ÿæœ‰ä¸€ä¸ªå°é—®é¢˜, ä»…é å®ƒæ˜¯ä¸å¤Ÿçš„<br></p>
      <hr class="border-2 border-dashed my-10">
      <h1 class="flex items-center w-fit my-6" id="utf-16,-ng"><span class="text-2xl mr-2 text-cyan-500">ğŸ”—</span> <a class="text-4xl hover:underline underline-offset-8" href="#utf-16,-ng">UTF-16, å—¯?</a></h1>
      <p>åœ¨æ¢ç´¢ Zed çš„ä»£ç åº“æ—¶, ä½ ä¼šå‘ç° <code class="font-semibold text-[#aa8bd5]"><code>OffsetUtf16</code></code> å…¶å®æ¯” <code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code> ä½¿ç”¨å¾—æ›´é¢‘ç¹ (è¿˜æœ‰ <code class="font-semibold text-[#aa8bd5]"><code>PointUtf16</code></code>)<br>æˆ‘ä¸ªäººä»ä¸éœ€å¤„ç† <code class="font-semibold text-[#aa8bd5]"><code>UTF-16</code></code>, é™¤å¼€ä½¿ç”¨ LSP(è¯­è¨€æœåŠ¡å™¨åè®®), è¯¥åè®®ä½¿ç”¨ UTF-16 ç¼–ç æ¥è®¡ç®—å’Œæè¿°æ–‡æœ¬çš„ä½ç½®å’Œåç§»é‡<br><br>è¿™å°±æ˜¯ZedåŒæ—¶æ‹¥æœ‰ <code class="font-semibold text-[#aa8bd5]"><code>OffsetUtf16</code></code> å’Œ <code class="font-semibold text-[#aa8bd5]"><code>PointUtf16</code></code> çš„åŸå› : ä¸è¯­è¨€æœåŠ¡å™¨é€šä¿¡<br>ä¾‹å¦‚, ä¸‹é¢æ˜¯ä¸€ä¸ªæŸ¥æ‰¾ç»™å®š position å¯¹åº”çš„ definition(å®šä¹‰) æ—¶çš„å‡½æ•°:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">fn definition&lt;T: ToPointUtf16>(
    &amp;self,
    buffer: &amp;Model&lt;Buffer>,
    position: T,
    cx: &amp;mut ModelContext&lt;Self>,
) -> Task&lt;Result&lt;Vec&lt;LocationLink>>> {
    let position = position.to_point_utf16(buffer.read(cx));
    self.definition_impl(buffer, position, cx)
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>è¯¥ position(ä¸€ä¸ªå®ç°äº† <code class="font-semibold text-[#aa8bd5]"><code>ToPointUtf16</code></code> çš„ç±»å‹ <code class="font-semibold text-[#aa8bd5]"><code>T</code></code>) åœ¨è¢«å‘é€ç»™è¯­è¨€æœåŠ¡å™¨å‰ä¼šè¢«è½¬æ¢ä¸º <code class="font-semibold text-[#aa8bd5]"><code>PointUtf16</code></code> ç±»å‹<br>åº•å±‚å®ç°ä¸­, è¿™å¯èƒ½ä¼šè°ƒç”¨ <code class="font-semibold text-[#aa8bd5]"><code>Rope</code></code> ç»“æ„ä½“ä¸Šçš„æ–¹æ³•:<br>(è¯‘è€…æ³¨: å…³äº Rope ç›¸å…³çš„å¯¹åº”åšå®¢æˆ‘ä¹Ÿç¿»è¯‘äº†: <a class="underline underline-offset-5 font-medium" href="/posts/zed-blog-translation/zed-decoded-rope-sumtree" hx-get="/posts/zed-blog-translation/zed-decoded-rope-sumtree/index.html" hx-target="body" hx-push-url="/posts/zed-blog-translation/zed-decoded-rope-sumtree" hx-swap="innerHTML show:window:top">ä¼ é€é—¨: Rope &amp; SumTree</a>)</p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">// crates/rope/src/rope.rs
 
impl Rope {
    fn point_to_point_utf16(&amp;self, point: Point) -> PointUtf16 {
        if point >= self.summary().lines {
            return self.summary().lines_utf16();
        }
        let mut cursor = self.chunks.cursor::&lt;(Point, PointUtf16)>();
        cursor.seek(&amp;point, Bias::Left, &amp;());
        let overshoot = point - cursor.start().0;
        cursor.start().1
        + cursor.item().map_or(PointUtf16::zero(), |chunk| {
            chunk.point_to_point_utf16(overshoot)
        })
    }
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>ä¸ºç†è§£è¿™é‡Œçš„æ¯ä¸€è¡Œ, æˆ‘å»ºè®®é˜…è¯»å…³äºä¹‹å‰çš„åšå®¢: <a class="underline underline-offset-5 font-medium" href="https://zed.dev/blog/zed-decoded-rope-sumtree">Rope &amp; SumTree</a> (è¯‘è€…æ³¨: å¯¹åº”ç¿»è¯‘: <a class="underline underline-offset-5 font-medium" href="/posts/zed-blog-translation/zed-decoded-rope-sumtree" hx-get="/posts/zed-blog-translation/zed-decoded-rope-sumtree/index.html" hx-target="body" hx-push-url="/posts/zed-blog-translation/zed-decoded-rope-sumtree" hx-swap="innerHTML show:window:top">ä¼ é€é—¨</a>)<br>ç›®å‰åªéœ€çŸ¥é“: ç”±äºè¯­è¨€æœåŠ¡å™¨, UTF-16 å¯¹ Zed æ¥è¯´è‡³å…³é‡è¦, ä»¥è‡³äºå®ç° Rope çš„ SumTree æ•°æ®ç»“æ„å·²ç›´æ¥ç´¢å¼•äº† UTF-16 çš„ points ä¸ offset<br>è¿™å¯¼è‡´äº§ç”Ÿäº†ä¸¤ä¸ªæ–°çš„æ–‡æœ¬åæ ‡ç³» <code class="font-semibold text-[#aa8bd5]"><code>PointUtf16</code></code> å’Œ <code class="font-semibold text-[#aa8bd5]"><code>OffsetUtf16</code></code>, å¹¶ä½¿å¾—å…¶ä¸ UTF-16 ä¹‹é—´çš„è½¬æ¢éå¸¸å¿«<br></p>
      <hr class="border-2 border-dashed my-10">
      <h1 class="flex items-center w-fit my-6" id="displaypoint"><span class="text-2xl mr-2 text-cyan-500">ğŸ”—</span> <a class="text-4xl hover:underline underline-offset-8" href="#displaypoint">DisplayPoint</a></h1>
      <p>æ²¿ç€æŠ½è±¡é˜¶æ¢¯å‘ä¸Šçˆ¬å‡, æŠ›å¼€ offset, row, column çš„æ¦‚å¿µ, æ¥ä¸‹æ¥å°±ä¼šé‡åˆ° <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code>, è¿™åˆæ˜¯ä¸ªå•¥?<br><code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> æ˜¯ä¸ªå›´ç»• <code class="font-semibold text-[#aa8bd5]"><code>BlockPoint</code></code> çš„ <a class="underline underline-offset-5 font-medium" href="https://doc.rust-lang.org/rust-by-example/generics/new_types.html">newtype</a>, å‘ƒå‘ƒ, é‚£ <code class="font-semibold text-[#aa8bd5]"><code>BlockPoint</code></code> åˆæ˜¯ä¸ªå•¥?<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">// crates/editor/src/display_map/block_map.rs
 
struct BlockPoint(pub Point);</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>ä¸€ä¸ª <code class="font-semibold text-[#aa8bd5]"><code>BlockPoint</code></code> å…¶å®å°±æ˜¯ä¸€ä¸ªâ€¦ <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> !<br>ç­‰ä¸‹! å•Š? è¿™æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¹¶æ²¡çˆ¬ä¸ŠæŠ½è±¡é˜¶æ¢¯, ä»…ä»…åœ¨æŠ½è±¡ä»“é¼ è½®é‡ŒåŸåœ°æ‰“è½¬?<br><br>å¹¶éå¹¶é, ä¸å®Œå…¨å¯¹, å› ä¸ºä¸€ä¸ª <code class="font-semibold text-[#aa8bd5]"><code>BlockPoint</code></code> ç¡®å®æ˜¯ä¸ª <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code>, ä½†åœ¨æ­¤ä¸Šä¸‹æ–‡(<code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> ä¸ç¼–è¾‘å™¨çš„ crate å†…éƒ¨)ä¸­, å…¶è¡Œåˆ—å«ä¹‰æœ‰æ‰€ä¸åŒ<br>å®ƒä»¬å¹¶éæŒ‡å‘ç£ç›˜ä¸Šæ–‡æœ¬æ–‡ä»¶ä¸­å¯¹åº”çš„è¡Œä¸åˆ—, è€Œæ˜¯æŒ‡å‘ä½ å®é™…å¯è§çš„, æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨ä¸Šçš„é‚£äº›è¡Œåˆ—, å› æ­¤æ‰ç§°ä¹‹ä¸º <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code><br>(è¯‘è€…æ³¨: æˆ‘çœŸæœäº†æ€ä¹ˆè¿™ä¹ˆä¼šæ°´)<br></p>
      <figure class="p-2 mb-2">
        <img class=" sm:w-[60%] mx-auto w-full rounded-lg" src="https://zed.dev/img/post/zed-decoded-text-coordinate-systems/screenshot_cursor_position.png">
        <figcaption class=" sm:w-[60%] mx-auto bg-[#212220] text-center w-full">å…‰æ ‡åœ¨å“ª?</figcaption>
      </figure>
      <p>å…‰æ ‡çš„ä½ç½®æ˜¯ä»€ä¹ˆ? ä»”ç»†è§‚å¯Ÿ, ä½œä¸ºä¸€ä¸ªæ™®é€šçš„ <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code>(ç´¢å¼•ä» 0 å¼€å§‹!), å®ƒå°†æ˜¯ line-23 ä¸ column-23<br>ä½†è‹¥ä½œä¸º <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code>, å…‰æ ‡çš„ä½ç½®æ˜¯ line-29 ä¸ column-36!<br><br>è¿™æ˜¯å› ä¸º <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> æè¿°äº† <code class="font-semibold text-[#aa8bd5]"><code>DisplayMap</code></code> ä¸Šçš„ä½ç½® (å¸Œæœ›æˆ‘ä»¬åœ¨åç»­çš„ Zed-Decoded å°å‰§åœºä¸­å¯ä»¥ä»‹ç»è¿™äº›), å¹¶è€ƒè™‘äº†:<br></p>
      <ul class="list-disc ml-5">
        <li>è½¯æ¢è¡Œ(soft-wrapping)</li>
        <li>æŠ˜å (folding)</li>
        <li>å†…è”æç¤º(inlay hints)</li>
        <li>åˆ¶è¡¨ç¬¦(tabs)</li>
        <li>ä»£ç å—ä¸æŠ˜ç—•(blocks &amp; creases)</li>
      </ul>
      <p><br>åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­å¯ä»¥çœ‹åˆ°, ç¬¬ 6 è¡Œæ˜¯ è½¯æ¢è¡Œ(soft-wrapping) çš„, å…¶å æ®äº†ä¸æ­¢ä¸€è¡Œç©ºé—´<br>åŒæ—¶, <code class="font-semibold text-[#aa8bd5]"><code>Point::MAX</code></code> çš„å®šä¹‰è¢«æŠ˜å , ä¸€ä¸ªä»£ç å—åŒºåŸŸæ­£åœ¨å±•ç¤ºè¯Šæ–­é”™è¯¯(diagnostic error), <code class="font-semibold text-[#aa8bd5]"><code>zero()</code></code> æ–¹æ³•ä¸­æœ‰ä¸¤å¤„å†…è”æç¤º(inlay hints)<br>è¯¥ <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> å…è®¸ Zed è€ƒè™‘æ‰€æœ‰æƒ…å†µ, å¹¶ç²¾å‡†æå™å…‰æ ‡æ‰€åœ¨çš„ä½ç½®!<br>è¿™é‡Œæ˜¯ä¸ªä¿®æ”¹è¿‡çš„ test, æˆ‘å‘ç°å…¶éå¸¸èƒ½è¯´æ˜ <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> çš„ä½œç”¨:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">// Modified version of a test in crates/editor/src/display_map.rs
 
async fn test_zed_decoded(cx: &amp;mut gpui::TestAppContext) {
    // [... setup ...]
 
    let font_size = px(12.0);
    let wrap_width = Some(px(64.));
 
    let text = "one two three four five\nsix seven eight";
    let buffer = MultiBuffer::build_simple(text, cx);
    let map = cx.new_model(|cx| {
        DisplayMap::new(
            buffer.clone(),
            font("Helvetica"),
            font_size,
            wrap_width,
            // [... other parameters ...]
        )
    });
 
    let snapshot = map.update(cx, |map, cx| map.snapshot(cx));
 
    // Given the above constraints â€” font_size, wrap_width, ... â€”Â the text above
    // is displayed in 5 lines.
    assert_eq!(
        snapshot.text_chunks(DisplayRow(0)).collect::&lt;String>(),
        "one two \nthree four \nfive\nsix seven \neight"
    );
 
    // DisplayPoint(1, 0) is equivalent to Point(0, 8)
    assert_eq!(
        DisplayPoint::new(DisplayRow(1), 0).to_point(&amp;snapshot),
        Point::new(0, 8)
    );
 
    // DisplayPoint(1, 2) is equivalent to Point(0, 10)
    assert_eq!(
        DisplayPoint::new(DisplayRow(1), 2).to_point(&amp;snapshot),
        Point::new(0, 10)
    );
 
    // DisplayPoint(4, 1) is equivalent to Point(1, 11)
    // (This is the "i" in "eight")
    assert_eq!(
        DisplayPoint::new(DisplayRow(4), 1).to_point(&amp;snapshot),
        Point::new(1, 11)
    );
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>ç”¨äºæµ‹è¯•çš„åŸå§‹æ–‡æœ¬:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-text text-sm sm:text-base">one two three four five
six seven eight</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>åœ¨ 12 åƒç´ å­—å·, 64 åƒç´ æ¢è¡Œå®½åº¦, Helvetica å­—ä½“ç­‰æ¡ä»¶ä¸‹, å®é™…ä¼šæ¸²æŸ“ä¸º:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-text text-sm sm:text-base">one two 
three four 
five
six seven 
eight</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>é€šè¿‡ <code class="font-semibold text-[#aa8bd5]"><code>DisplayMap</code></code>(æµ‹è¯•å‡½æ•°ä¸­çš„ <code class="font-semibold text-[#aa8bd5]"><code>snapshot</code></code> å˜é‡), æˆ‘ä»¬å¯ä»¥å®ç°ä¸¤ç§åæ ‡ç³»çš„è½¬æ¢:<br></p>
      <ul class="list-disc ml-5">
        <li><code class="font-semibold text-[#aa8bd5]"><code>Point::new(0, 10)</code></code> å¯¹åº”æ˜¾ç¤ºäº <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint::new(1, 2)</code></code></li>
        <li><code class="font-semibold text-[#aa8bd5]"><code>Point::new(1, 11)</code></code> å¯¹åº”æ˜¾ç¤ºäº <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint::new(4, 1)</code></code></li>
      </ul>
      <p><br>å¾ˆç²¾å¦™å“‡! è™½ç„¶åº•å±‚è¿˜æœ‰å¥½å¤šæœºåˆ¶å€¼å¾—æ¢è®¨, ä½†ç¯‡å¹…æ‰€é™, æˆ‘ä»¬è¯¥è®¨è®ºä¸‹ä¸€ä¸ªåæ ‡ç³»äº†, æˆ–è€…è¯´æˆ‘åŸä»¥ä¸ºæ˜¯åæ ‡ç³», å®åˆ™ä¸æ˜¯çš„: <code class="font-semibold text-[#aa8bd5]"><code>Anchors</code></code>(é”šç‚¹)<br></p>
      <hr class="border-2 border-dashed my-10">
      <h1 class="flex items-center w-fit my-6" id="anchor"><span class="text-2xl mr-2 text-cyan-500">ğŸ”—</span> <a class="text-4xl hover:underline underline-offset-8" href="#anchor">Anchor</a></h1>
      <p>åœ¨ä¸ Nathan å’Œ Antonio äº¤è°ˆå‰(æ‚¨å¯ä»¥è§‚çœ‹é…å¥—è§†é¢‘), æˆ‘çŸ¥é“ <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code>, å› ä¸ºæˆ‘å·²ç»åœ¨ä»£ç åº“ä¸­çœ‹è§äº† <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> ç±»å‹ä¸ç›¸å…³å‡½æ•°<br>æˆ‘å‡è®¾å®ƒä»¬æ˜¯è¡¨ç¤ºæ–‡æœ¬æ–‡æ¡£ä¸­ position çš„å¦ä¸€ç§æ–¹å¼/åæ ‡ç³»<br><br>ä½†å…¶å®è¿™æ˜¯é”™çš„, <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> ä¸æ–‡æœ¬æ–‡æ¡£ä¸­çš„ position ç›¸å…³, ä½†ä¸ <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code> æœ‰å¾ˆå¤§ä¸åŒ<br>å‡è®¾ä½ æœ‰è¿™æ ·ä¸€ä¸ªæ–‡æœ¬:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-text text-sm sm:text-base">Hello World!</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p><code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> å…è®¸ä½ æŒ‡å‘æ–‡æ¡£ä¸­ç»™å®šå­—ç¬¦çš„ä¸€ä¾§(å·¦ or å³), ä¾‹å¦‚é’ˆå¯¹ä¸Šé¢çš„æ–‡æœ¬, æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘ <code class="font-semibold text-[#aa8bd5]"><code>W</code></code> å·¦ä¾§çš„ <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code>, è¿™å°†æ¥è¿‘ <code class="font-semibold text-[#aa8bd5]"><code>Point::new(0, 6)</code></code><br>ä½†ä¸¤è€…é—´å­˜åœ¨ç€æœ¬è´¨å·®å¼‚: <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code> æè¿°äº† <code class="font-semibold text-[#aa8bd5]"><code>W</code></code> åœ¨å½“å‰æ–‡æ¡£ç‰ˆæœ¬ä¸­çš„ä½ç½®, <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> åˆ™ä¼šå§‹ç»ˆé™„ç€åœ¨è¯¥å­—æ¯çš„ä¾§è¾¹, å³ä½¿æ–‡æ¡£å†…å®¹å‘ç”Ÿç¼–è¾‘å˜åŠ¨<br><br>ç”¨ Nathan çš„è¯æ¥è¯´:<br></p>
      <blockquote class="border-l-4 border-solid border-gray-300 mx-1 my-3 px-4 opacity-60"><code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> æ˜¯é€»è¾‘åæ ‡, æ‚¨å¯ä»¥åœ¨å­—ç¬¦çš„å·¦/å³ä¾§åˆ›å»ºå®ƒ, æ­¤åä¸ç®¡ä½•æ—¶, æ‚¨éƒ½å¯ä»¥é‡æ–°å®šä½åˆ°å½“åˆæ ‡è®°çš„å­—ç¬¦ä½ç½®<br>å³ä½¿æœŸé—´å‘ç”Ÿè¿‡ç¼–è¾‘, æˆ–å­—ç¬¦å·²è¢«åˆ é™¤, æ‚¨ä»èƒ½è·å–å…¶é€»è¾‘ä½ç½®, å³å¢“ç¢‘(tombstone)ä½ç½®<br>è¿™ä¸ªä½ç½®æ—¢ä»£è¡¨è¯¥å­—ç¬¦æœªè¢«åˆ é™¤æ—¶çš„åŸå€, ä¹Ÿä»£è¡¨æ‰§è¡Œæ’¤é”€åˆ é™¤æ“ä½œåè¯¥å­—ç¬¦å°†é‡ç°çš„ä½ç½®<br></blockquote>
      <p>(è¯‘è€…æ³¨: è¿™åœ¨ CRDTs å¯¹åº”çš„åšæ–‡ä¸­ä¹Ÿæœ‰ç›¸å…³æ¶‰åŠ, æˆ‘ä¹Ÿè¿›è¡Œäº†ç¿»è¯‘: <a class="underline underline-offset-5 font-medium" href="/posts/zed-blog-translation/crdts" hx-get="/posts/zed-blog-translation/crdts/index.html" hx-target="body" hx-push-url="/posts/zed-blog-translation/crdts" hx-swap="innerHTML show:window:top">ä¼ é€é—¨</a>)<br><br>å› æ­¤, å¦‚æœæˆ‘ä»¬åœ¨ä¸Šæ–¹ <code class="font-semibold text-[#aa8bd5]"><code>W</code></code> çš„æ–‡æœ¬å·¦ä¾§æ·»åŠ ä¸€ä¸ª <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code>, ç„¶åå°†æ–‡æœ¬ç¼–è¾‘ä¸ºå¦‚ä¸‹æ‰€ç¤º:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-text text-sm sm:text-base">Hello and good day to you, World!</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>æˆ‘ä»¬ä»ç„¶å¯ä»¥ â€œèµå›â€ æˆ‘ä»¬çš„ <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code>, å¹¶å°†å…¶è½¬æ¢ä¸º <code class="font-semibold text-[#aa8bd5]"><code>W</code></code> æ­¤åˆ»æ‰€åœ¨ä½ç½®çš„å®é™… <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code><br>è¿™å¯¹åä½œæ–‡æœ¬ç¼–è¾‘æ„ä¹‰é‡å¤§: è‹¥æ‚¨çš„å…‰æ ‡ä½äº <code class="font-semibold text-[#aa8bd5]"><code>W</code></code>, æœ‰äººæ¥ç¼–è¾‘å…¶å·¦ä¾§, è‡ªå·±çš„å…‰æ ‡ä»åº”åœç•™åœ¨ <code class="font-semibold text-[#aa8bd5]"><code>W</code></code>, è€Œééšæ–‡æœ¬å˜åŠ¨è€Œæ¼‚ç§»(åƒç«™åœ¨ç§»åŠ¨åœ°æ¿ä¸Šä¸€èˆ¬ä¸å®‰!)<br><br>å½“æˆ‘ä»¬æŸ¥çœ‹ <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> çš„å®šä¹‰, ä½ å°±ä¼šå‘ç° Zed çš„åä½œæ€§è´¨å’Œ CRDT æœ‰å¤šä¹ˆå¯†åˆ‡çš„è”ç³»:<br></p>
      <pre class="group relative mx-2 sm:mx-6 my-4 border-2 border-slate-500 leading-[1.2em]"><script>
        function copy_code(button) {
          const code = button.parentElement.querySelector('code').innerText;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'å¥½å•¦';
            setTimeout(() => button.textContent = 'å¤åˆ¶', 2000);
          });
        }
        function fold_code(button) {
          const code = button.parentElement.querySelector('code');
          const next_fold_state = button.textContent
          if (next_fold_state == 'æŠ˜å ') {
            if (!code.hasAttribute('data-original')) {
              code.setAttribute('data-original', code.innerHTML)
            }
            const lines = code.innerHTML.split('\n')
            const firstLine = lines[0]
            code.innerHTML = firstLine
            // code.style.display = 'none'
            button.textContent = 'å±•å¼€'
          } else {
            const lines = code.getAttribute('data-original')
            // code.style.display = 'block'
            code.innerHTML = lines
            button.textContent = 'æŠ˜å '
          }
        }
      </script><p><code class=" language-rust text-sm sm:text-base">// crates/text/src/anchor.rs, slightly simplified
 
/// A timestamped position in a buffer
struct Anchor {
    timestamp: clock::Lamport,
    /// The byte offset in the buffer
    offset: usize,
    /// Describes which character the anchor is biased towards
    bias: Bias,
    buffer_id: Option&lt;BufferId>,
}</code></p><button class="absolute top-2 right-2 hidden group-hover:inline text-xl" onclick="copy_code(this)">å¤åˆ¶</button><button class="absolute top-2 right-16 hidden group-hover:inline text-xl" onclick="fold_code(this)">æŠ˜å </button></pre>
      <p>è¿™é‡Œçš„ <code class="font-semibold text-[#aa8bd5]"><code>timestamp</code></code> æ˜¯ <a class="underline underline-offset-5 font-medium" href="https://en.wikipedia.org/wiki/Lamport_timestamp">Lamport timestamp</a>, ä¸€ç§é€»è¾‘æ—¶é—´æˆ³<br>åœ¨æˆ‘ä»¬çš„å¯¹è¯ä¸­, Antonio è¯´åœ¨è¿™é‡Œçš„å­—æ®µå <code class="font-semibold text-[#aa8bd5]"><code>timestamp</code></code> å¹¶ä¸æ˜¯ä¸ªå¥½åå­—, å®ƒæ›¾è¢«ç§°ä¸º <code class="font-semibold text-[#aa8bd5]"><code>id</code></code><br><br>Nathans è§£é‡Šé“:<br></p>
      <blockquote class="border-l-4 border-solid border-gray-300 mx-1 my-3 px-4 opacity-60">åœ¨ CRDT ä¸­(æˆ–è‡³å°‘æˆ‘ä»¬ç›®å‰çš„ CRDT å®ç°ä¸­), æ¯æ®µæ–‡æœ¬, æ— è®ºæ˜¯å­—ç¬¦, ç²˜è´´çš„æ–‡æœ¬, è¿˜æ˜¯æ’å…¥çš„å…¶ä»–å†…å®¹, éƒ½ä¼šè¢«è§†ä¸ºä¸å¯å˜çš„ block<br>è¿™ä¸ªä¸å¯å˜çš„ block ä¼šè¢«èµ‹äºˆåœ¨å…¨éƒ¨é›†ç¾¤èŒƒå›´å†…å”¯ä¸€çš„ ID<br></blockquote>
      <p><br>ä¸Šé¢çš„ <code class="font-semibold text-[#aa8bd5]"><code>timestamp: clock::Lamport</code></code> å°±æ˜¯è¿™ä¸ª ID, Nathan ç»§ç»­è¯´é“:<br></p>
      <blockquote class="border-l-4 border-solid border-gray-300 mx-1 my-3 px-4 opacity-60">[â€¦] æœ¬è´¨ä¸Š, è¿™æ˜¯ä¸€ç§è·å¾—å”¯ä¸€ ID çš„æ–¹å¼, æ˜¯å§?<br>å…¶å”¯ä¸€æ€§ç»§æ‰¿è‡ªå‰¯æœ¬ ID, è€Œæ¯ä¸ªå‰¯æœ¬éƒ½å¯ä»¥é€šè¿‡å¢åŠ è‡ªèº«çš„åºåˆ—å·, ç„¶åå…¨å¤©è‡ªç”±åœ°ç”Ÿæˆæ–°çš„ Lamport æ—¶é—´æˆ³<br>å®ƒå®é™…ä¸Šæ˜¯ä¸º â€œæ’å…¥(insertion)â€ æ“ä½œ, ä¸ºæœ€åˆæ’å…¥çš„æ–‡æœ¬å—æ‰€è®¾è®¡çš„ ID<br></blockquote>
      <p><br>å› æ­¤ <code class="font-semibold text-[#aa8bd5]"><code>timestamp</code></code> æ˜¯åˆ†é…ç»™ä¸å¯å˜æ–‡æœ¬å—çš„å”¯ä¸€ ID, <code class="font-semibold text-[#aa8bd5]"><code>offset</code></code> ç´§è·Ÿå…¶å, æè¿°äº† <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> åœ¨è¿™æ®µæ–‡æœ¬ä¸­çš„ä½ç½®(å®ƒä¹Ÿæ˜¯ä¸å¯å˜çš„)<br>Nathan å¼€å§‹è§£é‡Š â€œä¸å¯å˜æ€§â€:<br></p>
      <blockquote class="border-l-4 border-solid border-gray-300 mx-1 my-3 px-4 opacity-60">ä¸€æ—¦æ’å…¥æ•°æ®, å®ƒå°±æ˜¯ä¸å¯å˜çš„, å³ä½¿ä½ åˆ é™¤éƒ¨åˆ†å†…å®¹, æˆ‘ä»¬ä¹Ÿåªæ˜¯å°†å…¶éšè—æˆ–æ ‡è®°ä¸ºå¢“ç¢‘è¿›è¡Œè®°å½•, ä½†å®ƒä»¬ä¾ç„¶å­˜åœ¨<br>é€šè¿‡è¿™ç§æ–¹å¼, æˆ‘ä»¬å®ç°äº†ååŒç¼–è¾‘, æ•´ä¸ªç³»ç»Ÿå§‹ç»ˆä¿æŒå•è°ƒé€’å¢çŠ¶æ€, æ•°æ®åªä¼šéšæ—¶é—´ç´¯ç§¯<br>æ­£å› å¦‚æ­¤, æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ insertion-ID, offset ç­‰ç¨³å®šçš„æ ‡è¯†è¿›è¡Œå®šä½<br>è™½ç„¶ç°åœ¨éœ€è¦é€šè¿‡å¤æ‚çš„ç´¢å¼•æœºåˆ¶æ¥ç²¾ç¡®å®šä½, ä½†è‡³å°‘æˆ‘ä»¬æ‹¥æœ‰äº†å¯ç¨³å®šå¼•ç”¨çš„å‚ç…§ç‚¹: è¿™ä¹Ÿæ˜¯æˆ‘ä»¬é€‰æ‹©é”šå®šå®ƒçš„åŸå› <br></blockquote>
      <p><br>ç”¨ Nathan çš„è¯æ¥è¯´, <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code> æ˜¯ä¸€ä¸ªé”šå®šç‚¹, é”šå®šäº†è¿™ä¸ª â€œå•è°ƒé€’å¢â€ çš„ç»“æ„:<br></p>
      <blockquote class="border-l-4 border-solid border-gray-300 mx-1 my-3 px-4 opacity-60">ä½†æœ€ç²¾å¦™çš„åœ°æ–¹åœ¨äº, è¿™ä¸ä»…å¯¹åä½œæœ‰ç”¨! é”šç‚¹è¿˜è¢«ç”¨äºæ–‡æœ¬çš„åå°å¤„ç†, ä¾‹å¦‚ä½ æƒ³æŠŠä¸€æ®µæ–‡æœ¬å‘é€ç»™åå°è¿è¡Œçš„è¯­è¨€æœåŠ¡å™¨<br>äºæ˜¯åˆ›å»ºäº†ä¸¤ä¸ª <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code>(è¢«é€‰æ–‡æœ¬çš„ start ä¸ end), ç„¶åå¯åŠ¨åå°è¿›ç¨‹, åˆ©ç”¨è¿™ä¸¤ä¸ªé”šç‚¹å°†æ–‡æœ¬å‘é€ç»™è¯­è¨€æœåŠ¡å™¨<br>ä¸æ­¤åŒæ—¶m ç”¨æˆ·ä»å¯ç»§ç»­è¾“å…¥å’Œä¿®æ”¹æ–‡æœ¬, å› ä¸ºè¿™ä¸¤ä¸ªé”šç‚¹å§‹ç»ˆæœ‰æ•ˆ, å®ƒä»¬è¢«å›ºå®šåœ¨äº†ä¸å¯å˜æ–‡æœ¬ç‰‡æ®µçš„å…·ä½“ä½ç½®ä¸Š<br></blockquote>
      <p><br>å°±è¿™æ ·å§, <code class="font-semibold text-[#aa8bd5]"><code>Point</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Offset</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>UTF-16</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>DisplayPoint</code></code>, <code class="font-semibold text-[#aa8bd5]"><code>Anchor</code></code>, è°ä¼šæƒ³åˆ°æˆ‘ä»¬èƒ½ä»è¡Œä¸åˆ—è½¬å‘ <code class="font-semibold text-[#aa8bd5]"><code>Lamport clock</code></code>?<br></p>
      <hr class="border-2 border-dashed my-10">
      <div class="flex flex-col sm:mx-2 *:my-2"><a class="flex items-center border-2 border-slate-500 w-full sm:rounded-md hover:border-white  justify-start " href="/posts/zed-blog-translation/text-manipulation" hx-get="/posts/zed-blog-translation/text-manipulation/index.html" hx-target="body" hx-push-url="/posts/zed-blog-translation/text-manipulation" hx-swap="innerHTML show:window:top"><span class="text-2xl sm:text-4xl sm:p-2 pl-2 pr-1 order-first ">&lt;</span> <span class="text-xl sm:text-2xl sm:p-2">æ–‡æœ¬å¤„ç†åŠŸå¤« ã® è¿›é˜¶çš„é»‘å¸¦</span></a></div>
    </div>
  </body>
</html>
